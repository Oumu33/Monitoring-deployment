# Telegraf VMware vSphere 监控配置
# 支持在单个实例中配置多个 vCenter
# 文件路径: config/telegraf/telegraf.conf

# ===== 全局配置 =====
[agent]
  interval = "60s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = ""
  hostname = ""
  omit_hostname = false

# ===== 输出到 VictoriaMetrics =====
[[outputs.http]]
  url = "http://victoriametrics:8428/api/v1/write"
  data_format = "prometheusremotewrite"

  [outputs.http.headers]
    Content-Type = "application/x-protobuf"
    Content-Encoding = "snappy"
    X-Prometheus-Remote-Write-Version = "0.1.0"

# ===== vCenter 配置示例 =====
# 请根据实际环境修改以下配置

# vCenter 1 - 主数据中心
[[inputs.vsphere]]
  ## vCenter Server 地址
  vcenters = ["https://vcenter.example.com/sdk"]

  ## 认证信息 (请修改为实际的用户名和密码)
  username = "monitoring@vsphere.local"
  password = "YourPassword123!"

  ## 采集间隔（可选，默认使用 agent.interval）
  interval = "60s"

  ## 超时时间
  timeout = "60s"

  ## 跳过 SSL 证书验证（自签名证书时使用）
  insecure_skip_verify = true

  ## 数据中心过滤（可选，不填则采集所有）
  # datacenters = ["Datacenter1"]

  ## 集群过滤（可选）
  # clusters = ["Cluster1", "Cluster2"]

  ## 虚拟机指标
  vm_metric_include = [
    "cpu.usage.average",
    "cpu.ready.summation",
    "cpu.usagemhz.average",
    "mem.usage.average",
    "mem.consumed.average",
    "mem.active.average",
    "net.usage.average",
    "net.bytesRx.average",
    "net.bytesTx.average",
    "disk.usage.average",
    "disk.read.average",
    "disk.write.average",
    "sys.uptime.latest"
  ]

  ## ESXi 主机指标
  host_metric_include = [
    "cpu.usage.average",
    "cpu.coreUtilization.average",
    "cpu.usagemhz.average",
    "mem.usage.average",
    "mem.consumed.average",
    "mem.active.average",
    "disk.usage.average",
    "net.usage.average",
    "sys.uptime.latest"
  ]

  ## 数据存储指标
  datastore_metric_include = [
    "disk.used.latest",
    "disk.capacity.latest",
    "disk.provisioned.latest"
  ]

  ## 自定义标签
  [inputs.vsphere.tags]
    datacenter = "dc1"
    location = "main"
    env = "production"

# ===== 添加更多 vCenter =====
# 复制以下配置块来添加更多 vCenter

# vCenter 2 - 示例（已注释）
# [[inputs.vsphere]]
#   vcenters = ["https://vcenter-dc2.example.com/sdk"]
#   username = "monitoring@vsphere.local"
#   password = "YourPassword456!"
#
#   interval = "60s"
#   timeout = "60s"
#   insecure_skip_verify = true
#
#   vm_metric_include = [
#     "cpu.usage.average",
#     "mem.usage.average",
#     "net.usage.average",
#     "disk.usage.average"
#   ]
#
#   host_metric_include = [
#     "cpu.usage.average",
#     "mem.usage.average",
#     "disk.usage.average"
#   ]
#
#   datastore_metric_include = [
#     "disk.used.latest",
#     "disk.capacity.latest"
#   ]
#
#   [inputs.vsphere.tags]
#     datacenter = "dc2"
#     location = "backup"
#     env = "production"

# ===== 配置说明 =====
#
# 1. vcenters: vCenter Server SDK 地址
#    格式: https://<vcenter-hostname-or-ip>/sdk
#
# 2. username/password: vSphere 用户凭据
#    推荐创建只读账号
#
# 3. interval: 采集间隔
#    生产环境推荐: 60s
#    分支/测试环境: 120s-300s
#
# 4. timeout: 采集超时时间
#    建议设置为 interval - 10s
#
# 5. insecure_skip_verify: 跳过 SSL 验证
#    自签名证书时设置为 true
#
# 6. 过滤选项:
#    - datacenters: 数据中心过滤
#    - clusters: 集群过滤
#    - hosts: 主机过滤
#    - vms: 虚拟机过滤
#    - resource_pools: 资源池过滤
#
# 7. 指标选择:
#    - vm_metric_include: 虚拟机指标
#    - host_metric_include: 主机指标
#    - datastore_metric_include: 数据存储指标
#
# 8. 自定义标签:
#    可以添加任意标签用于分组和过滤
#
# 更多配置选项:
# https://github.com/influxdata/telegraf/tree/master/plugins/inputs/vsphere
