# ===================================================================
# æœåŠ¡å™¨ç¡¬ä»¶ç›‘æ§å‘Šè­¦è§„åˆ™
# ç”¨é€”: ç›‘æ§ç‰©ç†æœåŠ¡å™¨ç¡¬ä»¶å¥åº·çŠ¶æ€ï¼ˆRedfish + IPMIï¼‰
# ===================================================================

groups:
  - name: hardware-alerts
    interval: 30s
    rules:

      # ===== ç³»ç»Ÿå¥åº·å‘Šè­¦ =====

      # ç³»ç»Ÿæ•´ä½“å¥åº·çŠ¶æ€å¼‚å¸¸
      - alert: HardwareSystemHealthCritical
        expr: redfish_system_health_status != 1
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: system
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} ç³»ç»Ÿå¥åº·çŠ¶æ€å¼‚å¸¸"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **å¥åº·çŠ¶æ€**: {{ $value }}

            **å½±å“**: ç³»ç»Ÿå¯èƒ½å­˜åœ¨ä¸¥é‡ç¡¬ä»¶æ•…éšœ

            **å¤„ç†æ­¥éª¤**:
            1. ç™»å½• BMC/iDRAC/iLO æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
            2. æ£€æŸ¥ç³»ç»Ÿäº‹ä»¶æ—¥å¿— (SEL)
            3. ç«‹å³æ›´æ¢æ•…éšœç¡¬ä»¶ç»„ä»¶
            4. å¦‚æ— æ³•ç«‹å³ä¿®å¤ï¼Œè€ƒè™‘è¿ç§»ä¸šåŠ¡
          runbook_url: "https://your-wiki.com/runbooks/hardware-system-health"

      # ===== CPU æ¸©åº¦å‘Šè­¦ =====

      # CPU æ¸©åº¦è¿‡é«˜ - Warning
      - alert: HardwareCPUTemperatureWarning
        expr: redfish_cpu_temperature > 80
        for: 5m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: cpu
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} CPU {{ $labels.cpu }} æ¸©åº¦åé«˜"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **CPU**: {{ $labels.cpu }}
            **å½“å‰æ¸©åº¦**: {{ $value }}Â°C
            **é˜ˆå€¼**: 80Â°C

            **å¯èƒ½åŸå› **:
            - æœºæˆ¿æ¸©åº¦è¿‡é«˜
            - é£æ‰‡æ•…éšœæˆ–è½¬é€Ÿä¸è¶³
            - CPU æ•£çƒ­å™¨ç°å°˜è¿‡å¤š
            - CPU è´Ÿè½½è¿‡é«˜

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥æœºæˆ¿ç©ºè°ƒç³»ç»Ÿ
            2. æ£€æŸ¥é£æ‰‡çŠ¶æ€å’Œè½¬é€Ÿ
            3. æ¸…ç†æ•£çƒ­å™¨ç°å°˜
            4. é™ä½ CPU è´Ÿè½½
          runbook_url: "https://your-wiki.com/runbooks/hardware-cpu-temp"

      # CPU æ¸©åº¦è¿‡é«˜ - Critical
      - alert: HardwareCPUTemperatureCritical
        expr: redfish_cpu_temperature > 90
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: cpu
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} CPU {{ $labels.cpu }} æ¸©åº¦ä¸¥é‡è¿‡é«˜"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **CPU**: {{ $labels.cpu }}
            **å½“å‰æ¸©åº¦**: {{ $value }}Â°C
            **é˜ˆå€¼**: 90Â°C

            **ç´§æ€¥**: å¯èƒ½å¯¼è‡´ CPU é™é¢‘æˆ–å…³æœº

            **ç«‹å³è¡ŒåŠ¨**:
            1. ç«‹å³æ£€æŸ¥é£æ‰‡æ˜¯å¦æ•…éšœ
            2. å¦‚é£æ‰‡æ•…éšœï¼Œç«‹å³æ›´æ¢
            3. è€ƒè™‘é™ä½æœåŠ¡å™¨è´Ÿè½½
            4. å¿…è¦æ—¶ç´§æ€¥åœæœºä¿æŠ¤ç¡¬ä»¶
          runbook_url: "https://your-wiki.com/runbooks/hardware-cpu-temp-critical"

      # ===== å†…å­˜å‘Šè­¦ =====

      # å†…å­˜ ECC é”™è¯¯
      - alert: HardwareMemoryECCWarnings
        expr: redfish_memory_ecc_errors > 0
        for: 5m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: memory
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} æ£€æµ‹åˆ°å†…å­˜ ECC é”™è¯¯"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å†…å­˜**: {{ $labels.memory }}
            **ECC é”™è¯¯æ•°**: {{ $value }}

            **å½±å“**: å†…å­˜æ•°æ®å®Œæ•´æ€§å¯èƒ½å—å½±å“

            **å¤„ç†æ­¥éª¤**:
            1. è®°å½•é”™è¯¯å‘ç”Ÿæ—¶é—´å’Œé¢‘ç‡
            2. è¿è¡Œå†…å­˜è¯Šæ–­æµ‹è¯•
            3. å¦‚é”™è¯¯æŒç»­å¢åŠ ï¼Œå»ºè®®æ›´æ¢å†…å­˜æ¡
            4. æ£€æŸ¥å†…å­˜æ’æ§½æ˜¯å¦æœ‰é—®é¢˜
          runbook_url: "https://your-wiki.com/runbooks/hardware-memory-ecc"

      # å†…å­˜å¥åº·çŠ¶æ€å¼‚å¸¸
      - alert: HardwareMemoryHealthCritical
        expr: redfish_memory_health_status != 1
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: memory
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} å†…å­˜ {{ $labels.memory }} å¥åº·çŠ¶æ€å¼‚å¸¸"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å†…å­˜**: {{ $labels.memory }}
            **å¥åº·çŠ¶æ€**: {{ $value }}

            **ç«‹å³è¡ŒåŠ¨**:
            1. ç«‹å³æ›´æ¢æ•…éšœå†…å­˜æ¡
            2. æ£€æŸ¥å†…å­˜æ’æ§½æ˜¯å¦æŸå
            3. æ›´æ¢åè¿è¡Œå†…å­˜æµ‹è¯•
          runbook_url: "https://your-wiki.com/runbooks/hardware-memory-health"

      # ===== ç£ç›˜å‘Šè­¦ =====

      # ç£ç›˜æ¸©åº¦è¿‡é«˜
      - alert: HardwareDiskTemperatureWarning
        expr: redfish_disk_temperature > 55
        for: 5m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: disk
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} ç£ç›˜ {{ $labels.disk }} æ¸©åº¦åé«˜"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç£ç›˜**: {{ $labels.disk }}
            **å½“å‰æ¸©åº¦**: {{ $value }}Â°C
            **é˜ˆå€¼**: 55Â°C

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥æœºç®±é£æ‰‡çŠ¶æ€
            2. æ£€æŸ¥ç£ç›˜æ˜¯å¦æœ‰å¼‚å¸¸å™ªéŸ³
            3. ç¡®ä¿æœºç®±é€šé£è‰¯å¥½
          runbook_url: "https://your-wiki.com/runbooks/hardware-disk-temp"

      # ç£ç›˜æ¸©åº¦ä¸¥é‡è¿‡é«˜
      - alert: HardwareDiskTemperatureCritical
        expr: redfish_disk_temperature > 65
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: disk
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} ç£ç›˜ {{ $labels.disk }} æ¸©åº¦ä¸¥é‡è¿‡é«˜"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç£ç›˜**: {{ $labels.disk }}
            **å½“å‰æ¸©åº¦**: {{ $value }}Â°C
            **é˜ˆå€¼**: 65Â°C

            **ç´§æ€¥**: ç£ç›˜å¯èƒ½å³å°†æŸå

            **ç«‹å³è¡ŒåŠ¨**:
            1. ç«‹å³å¤‡ä»½æ•°æ®
            2. æ›´æ¢æ•…éšœç£ç›˜
            3. æ£€æŸ¥æœºç®±æ•£çƒ­ç³»ç»Ÿ
          runbook_url: "https://your-wiki.com/runbooks/hardware-disk-temp-critical"

      # ç£ç›˜é¢„æµ‹æ€§æ•…éšœ
      - alert: HardwareDiskPredictFailure
        expr: redfish_disk_predict_failure == 1
        for: 5m
        labels:
          severity: warning
          priority: P1
          category: hardware
          component: disk
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} ç£ç›˜ {{ $labels.disk }} é¢„æµ‹å³å°†æ•…éšœ"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç£ç›˜**: {{ $labels.disk }}

            **å½±å“**: ç£ç›˜ SMART å±æ€§æ˜¾ç¤ºå¯èƒ½å³å°†æ•…éšœ

            **å¤„ç†æ­¥éª¤**:
            1. ç«‹å³å¤‡ä»½æ•°æ®
            2. æ›´æ¢ç£ç›˜
            3. é‡å»º RAID é˜µåˆ—
          runbook_url: "https://your-wiki.com/runbooks/hardware-disk-predict-failure"

      # ç£ç›˜åª’ä½“é”™è¯¯
      - alert: HardwareDiskMediaErrors
        expr: redfish_drive_media_errors > 0
        for: 5m
        labels:
          severity: warning
          priority: P1
          category: hardware
          component: disk
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} ç£ç›˜ {{ $labels.disk }} å‡ºç°åª’ä½“é”™è¯¯"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç£ç›˜**: {{ $labels.disk }}
            **é”™è¯¯æ•°**: {{ $value }}

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥ç£ç›˜ SMART ä¿¡æ¯
            2. å¤‡ä»½æ•°æ®
            3. è€ƒè™‘æ›´æ¢ç£ç›˜
          runbook_url: "https://your-wiki.com/runbooks/hardware-disk-media-errors"

      # ç£ç›˜å¥åº·çŠ¶æ€å¼‚å¸¸
      - alert: HardwareDiskHealthCritical
        expr: redfish_disk_status != 1
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: disk
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} ç£ç›˜ {{ $labels.disk }} å¥åº·çŠ¶æ€å¼‚å¸¸"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç£ç›˜**: {{ $labels.disk }}
            **çŠ¶æ€**: {{ $value }}

            **ç«‹å³è¡ŒåŠ¨**:
            1. æ£€æŸ¥ RAID çŠ¶æ€
            2. å¦‚ç£ç›˜æ•…éšœï¼Œç«‹å³æ›´æ¢
            3. é‡å»º RAID é˜µåˆ—
          runbook_url: "https://your-wiki.com/runbooks/hardware-disk-health"

      # ===== é£æ‰‡å‘Šè­¦ =====

      # é£æ‰‡è½¬é€Ÿè¿‡ä½
      - alert: HardwareFanSpeedLow
        expr: redfish_fan_speed < 1000
        for: 5m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: fan
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} é£æ‰‡ {{ $labels.fan }} è½¬é€Ÿè¿‡ä½"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **é£æ‰‡**: {{ $labels.fan }}
            **å½“å‰è½¬é€Ÿ**: {{ $value }} RPM
            **é˜ˆå€¼**: 1000 RPM

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥é£æ‰‡æ˜¯å¦è¢«ç°å°˜å µå¡
            2. æ£€æŸ¥é£æ‰‡ç”µæºè¿æ¥
            3. å¿…è¦æ—¶æ›´æ¢é£æ‰‡
          runbook_url: "https://your-wiki.com/runbooks/hardware-fan-speed"

      # é£æ‰‡æ•…éšœ
      - alert: HardwareFanFailed
        expr: redfish_fan_status != 1
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: fan
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} é£æ‰‡ {{ $labels.fan }} æ•…éšœ"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **é£æ‰‡**: {{ $labels.fan }}

            **ç´§æ€¥**: å¯èƒ½å¯¼è‡´ç³»ç»Ÿè¿‡çƒ­

            **ç«‹å³è¡ŒåŠ¨**:
            1. ç«‹å³æ›´æ¢æ•…éšœé£æ‰‡
            2. æ£€æŸ¥ç³»ç»Ÿæ¸©åº¦
            3. é˜²æ­¢è¿›ä¸€æ­¥è¿‡çƒ­
          runbook_url: "https://your-wiki.com/runbooks/hardware-fan-failed"

      # ===== ç”µæºå‘Šè­¦ =====

      # ç”µæºä¾›åº”æ•…éšœ
      - alert: HardwarePowerSupplyFailed
        expr: redfish_power_supply_status != 1
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: power
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} ç”µæº {{ $labels.power_supply }} æ•…éšœ"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç”µæº**: {{ $labels.power_supply }}

            **å½±å“**: ä¾›ç”µå†—ä½™å¯èƒ½å¤±æ•ˆ

            **ç«‹å³è¡ŒåŠ¨**:
            1. æ£€æŸ¥æ˜¯å¦æœ‰å¤‡ç”¨ç”µæºå·¥ä½œ
            2. ç«‹å³æ›´æ¢æ•…éšœç”µæº
            3. ç¡®ä¿ä¾›ç”µå†—ä½™æ­£å¸¸
          runbook_url: "https://your-wiki.com/runbooks/hardware-power-failed"

      # ===== æ¸©åº¦å‘Šè­¦ =====

      # è¿›é£å£æ¸©åº¦åé«˜
      - alert: HardwareInletTemperatureWarning
        expr: redfish_inlet_temperature > 30
        for: 10m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: system
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} è¿›é£å£æ¸©åº¦åé«˜"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **è¿›é£å£æ¸©åº¦**: {{ $value }}Â°C
            **é˜ˆå€¼**: 30Â°C

            **å¯èƒ½åŸå› **:
            - æœºæˆ¿ç©ºè°ƒä¸è¶³
            - æœºæ¶é€šé£ä¸è‰¯
            - æœåŠ¡å™¨å¸ƒå±€è¿‡äºå¯†é›†

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥æœºæˆ¿ç©ºè°ƒç³»ç»Ÿ
            2. æ£€æŸ¥æœºæ¶é€šé£
            3. è°ƒæ•´æœåŠ¡å™¨å¸ƒå±€
          runbook_url: "https://your-wiki.com/runbooks/hardware-inlet-temp"

      # å‡ºé£å£æ¸©åº¦åé«˜
      - alert: HardwareExhaustTemperatureWarning
        expr: redfish_exhaust_temperature > 45
        for: 10m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: system
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} å‡ºé£å£æ¸©åº¦åé«˜"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‡ºé£å£æ¸©åº¦**: {{ $value }}Â°C
            **é˜ˆå€¼**: 45Â°C

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥é£æ‰‡çŠ¶æ€
            2. æ£€æŸ¥æœåŠ¡å™¨è´Ÿè½½
            3. æ”¹å–„æœºæ¶é€šé£
          runbook_url: "https://your-wiki.com/runbooks/hardware-exhaust-temp"

      # ===== åŠŸè€—å‘Šè­¦ =====

      # åŠŸè€—å¼‚å¸¸é«˜
      - alert: HardwarePowerConsumptionHigh
        expr: redfish_power_consumed_watts > 800
        for: 10m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: power
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} åŠŸè€—åé«˜"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å½“å‰åŠŸè€—**: {{ $value }} W
            **é˜ˆå€¼**: 800 W

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥æœåŠ¡å™¨è´Ÿè½½
            2. æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸è¿›ç¨‹
            3. è¯„ä¼°æ˜¯å¦éœ€è¦ä¼˜åŒ–æˆ–æ‰©å®¹
          runbook_url: "https://your-wiki.com/runbooks/hardware-power-consumption"

      # ===== å…¶ä»–ç¡¬ä»¶å‘Šè­¦ =====

      # RAID æ§åˆ¶å™¨çŠ¶æ€å¼‚å¸¸
      - alert: HardwareRAIDControllerFailed
        expr: redfish_raid_controller_status != 1
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: raid
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} RAID æ§åˆ¶å™¨ {{ $labels.raid_controller }} çŠ¶æ€å¼‚å¸¸"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **RAID æ§åˆ¶å™¨**: {{ $labels.raid_controller }}

            **å½±å“**: å­˜å‚¨ç³»ç»Ÿå¯èƒ½ä¸å¯ç”¨

            **ç«‹å³è¡ŒåŠ¨**:
            1. æ£€æŸ¥ RAID æ§åˆ¶å™¨æ—¥å¿—
            2. å¦‚æ§åˆ¶å™¨æ•…éšœï¼Œç«‹å³æ›´æ¢
            3. æ¢å¤æ•°æ®
          runbook_url: "https://your-wiki.com/runbooks/hardware-raid-failed"

      # ç½‘ç»œæ¥å£çŠ¶æ€å¼‚å¸¸
      - alert: HardwareNetworkInterfaceFailed
        expr: redfish_network_interface_status != 1
        for: 5m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: network
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} ç½‘ç»œæ¥å£ {{ $labels.network_interface }} çŠ¶æ€å¼‚å¸¸"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç½‘ç»œæ¥å£**: {{ $labels.network_interface }}

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥ç½‘çº¿è¿æ¥
            2. æ£€æŸ¥äº¤æ¢æœºç«¯å£
            3. æ£€æŸ¥é©±åŠ¨ç¨‹åº
          runbook_url: "https://your-wiki.com/runbooks/hardware-network-failed"

      # BMC/iDRAC/iLO ä¸å¯è¾¾
      - alert: HardwareBMCDown
        expr: up{job="redfish-hardware"} == 0
        for: 5m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: bmc
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} BMC/iDRAC/iLO ä¸å¯è¾¾"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}

            **å¯èƒ½åŸå› **:
            - BMC æœåŠ¡æ•…éšœ
            - ç½‘ç»œä¸å¯è¾¾
            - BMC IP åœ°å€å˜æ›´

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
            2. ç™»å½•æœåŠ¡å™¨æ£€æŸ¥ BMC æœåŠ¡
            3. é‡å¯ BMC æœåŠ¡
          runbook_url: "https://your-wiki.com/runbooks/hardware-bmc-down"

# ===================================================================
# IPMI ç¡¬ä»¶ç›‘æ§å‘Šè­¦ï¼ˆè€æœåŠ¡å™¨å…œåº•æ–¹æ¡ˆï¼‰
# ===================================================================

  - name: ipmi-hardware-alerts
    interval: 30s
    rules:

      # IPMI ä¼ æ„Ÿå™¨æ•…éšœ
      - alert: IPMISensorFailed
        expr: ipmi_sensor_status != 1
        for: 5m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: sensor
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} IPMI ä¼ æ„Ÿå™¨ {{ $labels.sensor }} æ•…éšœ"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ä¼ æ„Ÿå™¨**: {{ $labels.sensor }}

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥ä¼ æ„Ÿå™¨ç‰©ç†è¿æ¥
            2. æ›´æ¢æ•…éšœä¼ æ„Ÿå™¨
          runbook_url: "https://your-wiki.com/runbooks/ipmi-sensor-failed"

      # IPMI æ¸©åº¦å‘Šè­¦
      - alert: IPMITemperatureHigh
        expr: ipmi_temperature_celsius > 80
        for: 5m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: temperature
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} IPMI æ¸©åº¦åé«˜"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **æ¸©åº¦**: {{ $value }}Â°C

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥é£æ‰‡çŠ¶æ€
            2. æ£€æŸ¥æœºæˆ¿æ¸©åº¦
          runbook_url: "https://your-wiki.com/runbooks/ipmi-temp-high"

      # IPMI é£æ‰‡æ•…éšœ
      - alert: IPMIFanFailed
        expr: ipmi_fan_status != 1
        for: 5m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: fan
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} IPMI é£æ‰‡ {{ $labels.fan }} æ•…éšœ"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **é£æ‰‡**: {{ $labels.fan }}

            **ç«‹å³è¡ŒåŠ¨**:
            1. ç«‹å³æ›´æ¢æ•…éšœé£æ‰‡
          runbook_url: "https://your-wiki.com/runbooks/ipmi-fan-failed"

      # IPMI ç”µæºæ•…éšœ
      - alert: IPMIPowerSupplyFailed
        expr: ipmi_power_supply_status != 1
        for: 5m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: power
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} IPMI ç”µæº {{ $labels.power_supply }} æ•…éšœ"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç”µæº**: {{ $labels.power_supply }}

            **ç«‹å³è¡ŒåŠ¨**:
            1. ç«‹å³æ›´æ¢æ•…éšœç”µæº
          runbook_url: "https://your-wiki.com/runbooks/ipmi-power-failed"

# ===================================================================
# å‘Šè­¦è§„åˆ™è¯´æ˜:
#
# 1. å‘Šè­¦ä¼˜å…ˆçº§:
#    - P0: ç¡¬ä»¶æ•…éšœï¼Œéœ€è¦ç«‹å³å¤„ç†ï¼ˆCPU æ¸©åº¦è¿‡é«˜ã€ç£ç›˜æ•…éšœã€é£æ‰‡æ•…éšœç­‰ï¼‰
#    - P1: é¢„æµ‹æ€§æ•…éšœï¼Œéœ€è¦å°½å¿«å¤„ç†ï¼ˆç£ç›˜é¢„æµ‹æ•…éšœã€ECC é”™è¯¯ç­‰ï¼‰
#    - P2: è­¦å‘Šçº§åˆ«ï¼Œéœ€è¦å…³æ³¨ï¼ˆæ¸©åº¦åé«˜ã€è½¬é€Ÿåä½ç­‰ï¼‰
#
# 2. å‘Šè­¦æŒç»­æ—¶é—´ (for):
#    - Critical: 2 åˆ†é’Ÿï¼ˆå¿«é€Ÿå“åº”ï¼‰
#    - Warning: 5-10 åˆ†é’Ÿï¼ˆé¿å…è¯¯æŠ¥ï¼‰
#
# 3. ç›‘æ§ç­–ç•¥:
#    - æ–°æœåŠ¡å™¨: Redfishï¼ˆæ¨èï¼Œæ”¯æŒæ›´å¤šæŒ‡æ ‡ï¼‰
#    - è€æœåŠ¡å™¨: IPMIï¼ˆå…œåº•æ–¹æ¡ˆï¼‰
#    - æ··åˆç¯å¢ƒ: ä¸¤ç§æ–¹æ¡ˆå¹¶è¡Œ
#
# 4. æ¸©åº¦é˜ˆå€¼å‚è€ƒ:
#    - CPU æ¸©åº¦: Warning 80Â°C, Critical 90Â°C
#    - ç£ç›˜æ¸©åº¦: Warning 55Â°C, Critical 65Â°C
#    - è¿›é£å£æ¸©åº¦: Warning 30Â°C
#    - å‡ºé£å£æ¸©åº¦: Warning 45Â°C
#
# 5. å‘Šè­¦æŠ‘åˆ¶:
#    - ç³»ç»Ÿå¥åº·å¼‚å¸¸æ—¶ï¼ŒæŠ‘åˆ¶ç»„ä»¶çº§å‘Šè­¦
#    - BMC ä¸å¯è¾¾æ—¶ï¼ŒæŠ‘åˆ¶æ‰€æœ‰ç¡¬ä»¶å‘Šè­¦
#
# æ›´å¤šæ–‡æ¡£: docs/HARDWARE-MONITORING.md
# ===================================================================

# ===================================================================
# VMware è”åŠ¨å‘Šè­¦è§„åˆ™
# ç”¨é€”: å…³è”ç‰©ç†æœåŠ¡å™¨ç¡¬ä»¶æ•…éšœä¸è™šæ‹Ÿæœºå½±å“
# ===================================================================

  - name: hardware-vmware-alerts
    interval: 60s
    rules:

      # ç‰©ç†æœåŠ¡å™¨æ•…éšœå½±å“è™šæ‹Ÿæœº
      - alert: PhysicalServerFailureImpactVM
        expr: |
          redfish_system_health_status != 1
          and on(instance) (
            count(vsphere_vm_power_state{power_state="poweredOn"}) by (instance) > 0
          )
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: system
          subcategory: vmware
        annotations:
          summary: "ğŸ”´ ç‰©ç†æœåŠ¡å™¨ {{ $labels.instance }} æ•…éšœå½±å“ {{ $value }} å°è™šæ‹Ÿæœº"
          description: |
            **ç‰©ç†æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **å½±å“è™šæ‹Ÿæœºæ•°é‡**: {{ $value }}

            **å½±å“èŒƒå›´**:
            - è™šæ‹Ÿæœºå¯èƒ½æ— æ³•è®¿é—®
            - ä¸šåŠ¡ä¸­æ–­

            **æ‹“æ‰‘é“¾è·¯**:
            ç‰©ç†æœåŠ¡å™¨ {{ $labels.instance }}
              â†“ (ç¡¬ä»¶æ•…éšœ)
            ESXi ä¸»æœº {{ $labels.esxhostname }}
              â†“ (è™šæ‹ŸåŒ–å±‚)
            è™šæ‹Ÿæœºåˆ—è¡¨:
            {{ $labels.vm_list }}

            **è¿æ¥å…³ç³»**:
            - äº¤æ¢æœº: {{ $labels.connected_switch }}
            - ç«¯å£: {{ $labels.connected_port }}
            - ç½‘ç»œæ®µ: {{ $labels.network_segment }}

            **å¤„ç†æ­¥éª¤**:
            1. ç«‹å³æ£€æŸ¥ç‰©ç†æœåŠ¡å™¨ç¡¬ä»¶çŠ¶æ€
            2. æŸ¥çœ‹å—å½±å“çš„è™šæ‹Ÿæœºåˆ—è¡¨
            3. è€ƒè™‘è¿ç§»è™šæ‹Ÿæœºåˆ°å…¶ä»–ä¸»æœº
            4. ä¿®å¤ç‰©ç†æœåŠ¡å™¨ç¡¬ä»¶é—®é¢˜
          vm_list: "{{ $labels.vm_list }}"
          connected_switch: "{{ $labels.connected_switch }}"
          connected_port: "{{ $labels.connected_port }}"
          network_segment: "{{ $labels.network_segment }}"
          topology_chain: "ç‰©ç†æœåŠ¡å™¨ â†’ ESXi ä¸»æœº â†’ è™šæ‹Ÿæœº"
          runbook_url: "https://your-wiki.com/runbooks/physical-server-vm-impact"

      # CPU æ¸©åº¦è¿‡é«˜å½±å“è™šæ‹Ÿæœºæ€§èƒ½
      - alert: HardwareCPUTemperatureImpactVM
        expr: |
          redfish_cpu_temperature > 85
          and on(instance) (
            avg(vsphere_vm_cpu_usage_average{power_state="poweredOn"}) by (instance) > 70
          )
        for: 5m
        labels:
          severity: warning
          priority: P1
          category: hardware
          component: cpu
          subcategory: vmware
        annotations:
          summary: "âš ï¸ ç‰©ç†æœåŠ¡å™¨ {{ $labels.instance }} CPU æ¸©åº¦è¿‡é«˜å½±å“è™šæ‹Ÿæœºæ€§èƒ½"
          description: |
            **ç‰©ç†æœåŠ¡å™¨**: {{ $labels.instance }}
            **CPU**: {{ $labels.cpu }}
            **å½“å‰æ¸©åº¦**: {{ $value }}Â°C
            **è™šæ‹Ÿæœºå¹³å‡ CPU ä½¿ç”¨ç‡**: {{ $value }}%

            **å½±å“**:
            - CPU å¯èƒ½é™é¢‘
            - è™šæ‹Ÿæœºæ€§èƒ½ä¸‹é™

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥é£æ‰‡çŠ¶æ€
            2. è€ƒè™‘è¿ç§»éƒ¨åˆ†è™šæ‹Ÿæœº
            3. é™ä½æœåŠ¡å™¨è´Ÿè½½
          runbook_url: "https://your-wiki.com/runbooks/cpu-temp-vm-impact"

      # å†…å­˜æ•…éšœå½±å“è™šæ‹Ÿæœº
      - alert: HardwareMemoryFailureImpactVM
        expr: |
          redfish_memory_health_status != 1
          and on(instance) (
            count(vsphere_vm_memory_usage_average{power_state="poweredOn"}) by (instance) > 0
          )
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: memory
          subcategory: vmware
        annotations:
          summary: "ğŸ”´ ç‰©ç†æœåŠ¡å™¨ {{ $labels.instance }} å†…å­˜æ•…éšœå½±å“ {{ $value }} å°è™šæ‹Ÿæœº"
          description: |
            **ç‰©ç†æœåŠ¡å™¨**: {{ $labels.instance }}
            **å†…å­˜**: {{ $labels.memory }}
            **å½±å“è™šæ‹Ÿæœºæ•°é‡**: {{ $value }}

            **å½±å“**:
            - è™šæ‹Ÿæœºå¯èƒ½å´©æºƒ
            - æ•°æ®æŸåé£é™©

            **å¤„ç†æ­¥éª¤**:
            1. ç«‹å³è¿ç§»å—å½±å“çš„è™šæ‹Ÿæœº
            2. æ›´æ¢æ•…éšœå†…å­˜
          runbook_url: "https://your-wiki.com/runbooks/memory-failure-vm-impact"

      # ç£ç›˜æ•…éšœå½±å“è™šæ‹Ÿæœº
      - alert: HardwareDiskFailureImpactVM
        expr: |
          redfish_disk_status != 1
          and on(instance) (
            count(vsphere_vm_disk_usage_average{power_state="poweredOn"}) by (instance) > 0
          )
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: disk
          subcategory: vmware
        annotations:
          summary: "ğŸ”´ ç‰©ç†æœåŠ¡å™¨ {{ $labels.instance }} ç£ç›˜æ•…éšœå½±å“ {{ $value }} å°è™šæ‹Ÿæœº"
          description: |
            **ç‰©ç†æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç£ç›˜**: {{ $labels.disk }}
            **å½±å“è™šæ‹Ÿæœºæ•°é‡**: {{ $value }}

            **å½±å“**:
            - è™šæ‹Ÿæœºç£ç›˜ I/O å¼‚å¸¸
            - æ•°æ®ä¸¢å¤±é£é™©

            **å¤„ç†æ­¥éª¤**:
            1. ç«‹å³å¤‡ä»½å—å½±å“çš„è™šæ‹Ÿæœº
            2. è¿ç§»è™šæ‹Ÿæœºåˆ°å…¶ä»–ä¸»æœº
            3. æ›´æ¢æ•…éšœç£ç›˜
          runbook_url: "https://your-wiki.com/runbooks/disk-failure-vm-impact"

      # ç”µæºæ•…éšœå½±å“è™šæ‹Ÿæœº
      - alert: HardwarePowerSupplyFailureImpactVM
        expr: |
          redfish_power_supply_status != 1
          and on(instance) (
            count(vsphere_vm_power_state{power_state="poweredOn"}) by (instance) > 0
          )
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: power
          subcategory: vmware
        annotations:
          summary: "ğŸ”´ ç‰©ç†æœåŠ¡å™¨ {{ $labels.instance }} ç”µæºæ•…éšœå½±å“ {{ $value }} å°è™šæ‹Ÿæœº"
          description: |
            **ç‰©ç†æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç”µæº**: {{ $labels.power_supply }}
            **å½±å“è™šæ‹Ÿæœºæ•°é‡**: {{ $value }}

            **å½±å“**:
            - æœåŠ¡å™¨å¯èƒ½æ„å¤–å…³æœº
            - æ‰€æœ‰è™šæ‹Ÿæœºä¸­æ–­

            **å¤„ç†æ­¥éª¤**:
            1. ç«‹å³è¿ç§»æ‰€æœ‰è™šæ‹Ÿæœº
            2. æ›´æ¢æ•…éšœç”µæº
            3. æ£€æŸ¥ç”µæºå†—ä½™é…ç½®
          runbook_url: "https://your-wiki.com/runbooks/power-failure-vm-impact"

      # ç‰©ç†æœåŠ¡å™¨å®¹é‡ä¸è¶³å‘Šè­¦
      - alert: PhysicalServerCapacityWarning
        expr: |
          (
            (vsphere_host_cpu_usage_average > 80) or 
            (vsphere_host_memory_usage_average > 85)
          )
          and on(instance) (
            redfish_system_health_status == 1
          )
        for: 10m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: capacity
          subcategory: vmware
        annotations:
          summary: "âš ï¸ ç‰©ç†æœåŠ¡å™¨ {{ $labels.instance }} å®¹é‡æ¥è¿‘ä¸Šé™"
          description: |
            **ç‰©ç†æœåŠ¡å™¨**: {{ $labels.instance }}
            **CPU ä½¿ç”¨ç‡**: {{ $labels.cpu_usage }}%
            **å†…å­˜ä½¿ç”¨ç‡**: {{ $labels.memory_usage }}%

            **å½±å“**:
            - æ— æ³•åˆ›å»ºæ–°è™šæ‹Ÿæœº
            - ç°æœ‰è™šæ‹Ÿæœºæ€§èƒ½ä¸‹é™

            **å¤„ç†æ­¥éª¤**:
            1. è¿ç§»éƒ¨åˆ†è™šæ‹Ÿæœºåˆ°å…¶ä»–ä¸»æœº
            2. è€ƒè™‘æ‰©å®¹
          runbook_url: "https://your-wiki.com/runbooks/capacity-warning"

# ===================================================================
# ç¡¬ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†å‘Šè­¦è§„åˆ™
# ç”¨é€”: ä¿ä¿®ã€è€åŒ–ã€å®¹é‡è§„åˆ’
# ===================================================================

  - name: hardware-lifecycle-alerts
    interval: 60s
    rules:

      # ä¿ä¿®å³å°†åˆ°æœŸå‘Šè­¦ï¼ˆ90å¤©ï¼‰
      - alert: HardwareWarrantyExpiring
        expr: |
          redfish_warranty_days_remaining > 0 
          and redfish_warranty_days_remaining <= 90
        for: 1m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: warranty
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} ä¿ä¿®å³å°†åˆ°æœŸ"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‰©ä½™ä¿ä¿®å¤©æ•°**: {{ $value }} å¤©
            **ä¿ä¿®åˆ°æœŸæ—¥æœŸ**: {{ $labels.warranty_expiry }}

            **å»ºè®®æ“ä½œ**:
            - è”ç³»å‚å•†ç»­ä¿
            - è¯„ä¼°æ˜¯å¦éœ€è¦æ›´æ¢è®¾å¤‡
          runbook_url: "https://your-wiki.com/runbooks/warranty-expiring"

      # ä¿ä¿®å·²åˆ°æœŸå‘Šè­¦
      - alert: HardwareWarrantyExpired
        expr: |
          redfish_warranty_days_remaining <= 0
        for: 1m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: warranty
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} ä¿ä¿®å·²åˆ°æœŸ"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ä¿ä¿®åˆ°æœŸæ—¥æœŸ**: {{ $labels.warranty_expiry }}

            **å»ºè®®æ“ä½œ**:
            - è”ç³»å‚å•†ç»­ä¿ï¼ˆå¦‚å¯èƒ½ï¼‰
            - åˆ¶å®šè®¾å¤‡æ›´æ¢è®¡åˆ’
          runbook_url: "https://your-wiki.com/runbooks/warranty-expired"

      # ç¡¬ä»¶è€åŒ–å‘Šè­¦ï¼ˆè¿è¡Œè¶…è¿‡5å¹´ï¼‰
      - alert: HardwareAging
        expr: |
          (time() - redfish_install_date) / (365 * 24 * 3600) > 5
        for: 1m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: aging
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} å·²è¿è¡Œè¶…è¿‡ 5 å¹´"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **è¿è¡Œå¹´é™**: {{ $value }} å¹´

            **å»ºè®®æ“ä½œ**:
            - åˆ¶å®šè®¾å¤‡æ›´æ¢è®¡åˆ’
            - å¢åŠ ç›‘æ§é¢‘ç‡
            - å‡†å¤‡å¤‡ç”¨è®¾å¤‡
          runbook_url: "https://your-wiki.com/runbooks/hardware-aging"

      # ç¡¬ä»¶ä¸¥é‡è€åŒ–å‘Šè­¦ï¼ˆè¿è¡Œè¶…è¿‡7å¹´ï¼‰
      - alert: HardwareSevereAging
        expr: |
          (time() - redfish_install_date) / (365 * 24 * 3600) > 7
        for: 1m
        labels:
          severity: critical
          priority: P1
          category: hardware
          component: aging
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} å·²è¿è¡Œè¶…è¿‡ 7 å¹´ï¼Œå»ºè®®ç«‹å³æ›´æ¢"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **è¿è¡Œå¹´é™**: {{ $value }} å¹´

            **å»ºè®®æ“ä½œ**:
            - ç«‹å³åˆ¶å®šè®¾å¤‡æ›´æ¢è®¡åˆ’
            - å¢åŠ ç›‘æ§å’Œå¤‡ä»½é¢‘ç‡
            - å‡†å¤‡å¤‡ç”¨è®¾å¤‡
          runbook_url: "https://your-wiki.com/runbooks/hardware-severe-aging"

      # ç¡¬ç›˜æ•…éšœç‡è¿‡é«˜å‘Šè­¦
      - alert: HardwareDiskFailureRateHigh
        expr: |
          count(redfish_disk_status != 1) by (instance) 
          / count(redfish_disk_status) by (instance) > 0.2
        for: 10m
        labels:
          severity: critical
          priority: P1
          category: hardware
          component: disk
          subcategory: lifecycle
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} ç¡¬ç›˜æ•…éšœç‡è¿‡é«˜"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **ç¡¬ç›˜æ•…éšœç‡**: {{ $value | humanizePercentage }}

            **å»ºè®®æ“ä½œ**:
            - ç«‹å³æ›´æ¢æ•…éšœç¡¬ç›˜
            - æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ¢æ‰€æœ‰ç¡¬ç›˜
            - åˆ¶å®šæ‰©å®¹æˆ–æ›´æ¢è®¡åˆ’
          runbook_url: "https://your-wiki.com/runbooks/disk-failure-rate-high"

      # å®¹é‡è§„åˆ’å‘Šè­¦ï¼ˆæœºæ¶çº§åˆ«ï¼‰
      - alert: RackCapacityPlanning
        expr: |
          count(redfish_disk_status == 1) by (rack) 
          / count(redfish_disk_status) by (rack) < 0.8
        for: 10m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: capacity
          subcategory: planning
        annotations:
          summary: "âš ï¸ æœºæ¶ {{ $labels.rack }} ç¡¬ç›˜æ•…éšœç‡è¿‡é«˜ï¼Œå»ºè®®æ‰©å®¹"
          description: |
            **æœºæ¶**: {{ $labels.rack }}
            **å¥åº·ç¡¬ç›˜ç‡**: {{ $value | humanizePercentage }}

            **å»ºè®®æ“ä½œ**:
            - åˆ¶å®šæ‰©å®¹è®¡åˆ’
            - æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ¢æœºæ¶
          runbook_url: "https://your-wiki.com/runbooks/rack-capacity-planning"

      # èµ„äº§æ ‡ç­¾ç¼ºå¤±å‘Šè­¦
      - alert: HardwareAssetTagMissing
        expr: |
          redfish_asset_tag == ""
        for: 1m
        labels:
          severity: warning
          priority: P3
          category: hardware
          component: asset
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} ç¼ºå°‘èµ„äº§æ ‡ç­¾"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **åºåˆ—å·**: {{ $labels.serial_number }}

            **å»ºè®®æ“ä½œ**:
            - æ·»åŠ èµ„äº§æ ‡ç­¾
            - æ›´æ–°èµ„äº§ç®¡ç†ç³»ç»Ÿ
          runbook_url: "https://your-wiki.com/runbooks/asset-tag-missing"

# ===================================================================
# ç¡¬ä»¶æ•…éšœ + è‡ªåŠ¨å·¥å•å‘Šè­¦è§„åˆ™
# ç”¨é€”: ç¡¬ä»¶æ•…éšœè‡ªåŠ¨åˆ›å»ºå·¥å•ï¼Œè‡ªåŠ¨åŒ–è¿ç»´æµç¨‹
# ===================================================================

  - name: hardware-auto-ticket-alerts
    interval: 60s
    rules:

      # ç£ç›˜æ•…éšœè‡ªåŠ¨åˆ›å»ºå·¥å•
      - alert: DiskFailureAutoTicket
        expr: |
          redfish_disk_status != 1
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: disk
          subcategory: ticket
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} ç£ç›˜æ•…éšœï¼Œå·²è‡ªåŠ¨åˆ›å»ºå·¥å•"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **ç£ç›˜**: {{ $labels.disk }}
            **åºåˆ—å·**: {{ $labels.serial_number }}

            **å·¥å•ä¿¡æ¯**:
            - å·¥å•ç³»ç»Ÿ: Jira
            - å·¥å•ç±»å‹: ç¡¬ä»¶æ•…éšœ
            - åˆ†é…ç»™: ç¡¬ä»¶å›¢é˜Ÿ
            - ä¼˜å…ˆçº§: æœ€é«˜
            - å·¥å•å·: {{ $labels.ticket_id }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹å·¥å•è¯¦æƒ…
            2. å¤‡ä»½æ•°æ®
            3. æ›´æ¢æ•…éšœç£ç›˜
          auto_ticket: true
          ticket_system: jira
          ticket_type: hardware_failure
          assignee: hardware-team
          ticket_id: "{{ $labels.ticket_id }}"
          runbook_url: "https://your-wiki.com/runbooks/disk-failure-ticket"

      # å†…å­˜æ•…éšœè‡ªåŠ¨åˆ›å»ºå·¥å•
      - alert: MemoryFailureAutoTicket
        expr: |
          redfish_memory_health_status != 1
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: memory
          subcategory: ticket
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} å†…å­˜æ•…éšœï¼Œå·²è‡ªåŠ¨åˆ›å»ºå·¥å•"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **å†…å­˜**: {{ $labels.memory }}
            **åºåˆ—å·**: {{ $labels.serial_number }}

            **å·¥å•ä¿¡æ¯**:
            - å·¥å•ç³»ç»Ÿ: Jira
            - å·¥å•ç±»å‹: ç¡¬ä»¶æ•…éšœ
            - åˆ†é…ç»™: ç¡¬ä»¶å›¢é˜Ÿ
            - ä¼˜å…ˆçº§: æœ€é«˜
            - å·¥å•å·: {{ $labels.ticket_id }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹å·¥å•è¯¦æƒ…
            2. è¿ç§»è™šæ‹Ÿæœºï¼ˆå¦‚éœ€è¦ï¼‰
            3. æ›´æ¢æ•…éšœå†…å­˜
          auto_ticket: true
          ticket_system: jira
          ticket_type: hardware_failure
          assignee: hardware-team
          ticket_id: "{{ $labels.ticket_id }}"
          runbook_url: "https://your-wiki.com/runbooks/memory-failure-ticket"

      # ç”µæºæ•…éšœè‡ªåŠ¨åˆ›å»ºå·¥å•
      - alert: PowerSupplyFailureAutoTicket
        expr: |
          redfish_power_supply_status != 1
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: power
          subcategory: ticket
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} ç”µæºæ•…éšœï¼Œå·²è‡ªåŠ¨åˆ›å»ºå·¥å•"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **ç”µæº**: {{ $labels.power_supply }}
            **åºåˆ—å·**: {{ $labels.serial_number }}

            **å·¥å•ä¿¡æ¯**:
            - å·¥å•ç³»ç»Ÿ: Jira
            - å·¥å•ç±»å‹: ç¡¬ä»¶æ•…éšœ
            - åˆ†é…ç»™: ç¡¬ä»¶å›¢é˜Ÿ
            - ä¼˜å…ˆçº§: æœ€é«˜
            - å·¥å•å·: {{ $labels.ticket_id }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹å·¥å•è¯¦æƒ…
            2. æ£€æŸ¥ç”µæºå†—ä½™
            3. æ›´æ¢æ•…éšœç”µæº
          auto_ticket: true
          ticket_system: jira
          ticket_type: hardware_failure
          assignee: hardware-team
          ticket_id: "{{ $labels.ticket_id }}"
          runbook_url: "https://your-wiki.com/runbooks/power-failure-ticket"

      # é£æ‰‡æ•…éšœè‡ªåŠ¨åˆ›å»ºå·¥å•
      - alert: FanFailureAutoTicket
        expr: |
          redfish_fan_status != 1
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: hardware
          component: fan
          subcategory: ticket
        annotations:
          summary: "ğŸ”´ æœåŠ¡å™¨ {{ $labels.instance }} é£æ‰‡æ•…éšœï¼Œå·²è‡ªåŠ¨åˆ›å»ºå·¥å•"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **é£æ‰‡**: {{ $labels.fan }}
            **åºåˆ—å·**: {{ $labels.serial_number }}

            **å·¥å•ä¿¡æ¯**:
            - å·¥å•ç³»ç»Ÿ: Jira
            - å·¥å•ç±»å‹: ç¡¬ä»¶æ•…éšœ
            - åˆ†é…ç»™: ç¡¬ä»¶å›¢é˜Ÿ
            - ä¼˜å…ˆçº§: é«˜
            - å·¥å•å·: {{ $labels.ticket_id }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹å·¥å•è¯¦æƒ…
            2. æ£€æŸ¥æ¸©åº¦
            3. æ›´æ¢æ•…éšœé£æ‰‡
          auto_ticket: true
          ticket_system: jira
          ticket_type: hardware_failure
          assignee: hardware-team
          ticket_id: "{{ $labels.ticket_id }}"
          runbook_url: "https://your-wiki.com/runbooks/fan-failure-ticket"

      # ä¿ä¿®åˆ°æœŸè‡ªåŠ¨åˆ›å»ºé‡‡è´­å·¥å•
      - alert: WarrantyExpiringAutoTicket
        expr: |
          redfish_warranty_days_remaining > 0 
          and redfish_warranty_days_remaining <= 90
        for: 1m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: warranty
          subcategory: ticket
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} ä¿ä¿®å³å°†åˆ°æœŸï¼Œå·²è‡ªåŠ¨åˆ›å»ºé‡‡è´­å·¥å•"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **å‰©ä½™ä¿ä¿®å¤©æ•°**: {{ $value }} å¤©
            **ä¿ä¿®åˆ°æœŸæ—¥æœŸ**: {{ $labels.warranty_expiry }}

            **å·¥å•ä¿¡æ¯**:
            - å·¥å•ç³»ç»Ÿ: Jira
            - å·¥å•ç±»å‹: é‡‡è´­ç”³è¯·
            - åˆ†é…ç»™: é‡‡è´­å›¢é˜Ÿ
            - ä¼˜å…ˆçº§: ä¸­
            - å·¥å•å·: {{ $labels.ticket_id }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹å·¥å•è¯¦æƒ…
            2. è”ç³»å‚å•†ç»­ä¿
            3. è¯„ä¼°æ˜¯å¦éœ€è¦æ›´æ¢è®¾å¤‡
          auto_ticket: true
          ticket_system: jira
          ticket_type: procurement
          assignee: procurement-team
          ticket_id: "{{ $labels.ticket_id }}"
          runbook_url: "https://your-wiki.com/runbooks/warranty-expiring-ticket"

      # è®¾å¤‡è€åŒ–è‡ªåŠ¨åˆ›å»ºæ›´æ¢å·¥å•
      - alert: HardwareAgingAutoTicket
        expr: |
          (time() - redfish_install_date) / (365 * 24 * 3600) > 7
        for: 1m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: aging
          subcategory: ticket
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} å·²è¿è¡Œè¶…è¿‡ 7 å¹´ï¼Œå·²è‡ªåŠ¨åˆ›å»ºæ›´æ¢å·¥å•"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **è¿è¡Œå¹´é™**: {{ $value }} å¹´

            **å·¥å•ä¿¡æ¯**:
            - å·¥å•ç³»ç»Ÿ: Jira
            - å·¥å•ç±»å‹: è®¾å¤‡æ›´æ¢
            - åˆ†é…ç»™: ç¡¬ä»¶å›¢é˜Ÿ
            - ä¼˜å…ˆçº§: ä¸­
            - å·¥å•å·: {{ $labels.ticket_id }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹å·¥å•è¯¦æƒ…
            2. åˆ¶å®šè®¾å¤‡æ›´æ¢è®¡åˆ’
            3. å‡†å¤‡é¢„ç®—å’Œé‡‡è´­
          auto_ticket: true
          ticket_system: jira
          ticket_type: equipment_replacement
          assignee: hardware-team
          ticket_id: "{{ $labels.ticket_id }}"
          runbook_url: "https://your-wiki.com/runbooks/hardware-aging-ticket"

      # èµ„äº§å˜æ›´è‡ªåŠ¨åŒæ­¥ CMDB
      - alert: AssetChangeAutoSyncCMDB
        expr: |
          changes(redfish_asset_tag[1h]) > 0
        for: 1m
        labels:
          severity: info
          priority: P3
          category: hardware
          component: asset
          subcategory: cmdb
        annotations:
          summary: "â„¹ï¸ æœåŠ¡å™¨ {{ $labels.instance }} èµ„äº§ä¿¡æ¯å·²å˜æ›´ï¼Œå·²è‡ªåŠ¨åŒæ­¥åˆ° CMDB"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **èµ„äº§æ ‡ç­¾**: {{ $labels.asset_tag }}
            **åºåˆ—å·**: {{ $labels.serial_number }}

            **åŒæ­¥ä¿¡æ¯**:
            - CMDB ç³»ç»Ÿ: ServiceNow
            - åŒæ­¥ç±»å‹: èµ„äº§æ›´æ–°
            - åŒæ­¥æ—¶é—´: {{ $value }}

            **å¤„ç†æ­¥éª¤**:
            1. ç¡®è®¤ CMDB åŒæ­¥æˆåŠŸ
            2. éªŒè¯èµ„äº§ä¿¡æ¯
            3. æ›´æ–°ç›¸å…³æ–‡æ¡£
          auto_sync: true
          sync_target: cmdb
          sync_type: asset_update
          runbook_url: "https://your-wiki.com/runbooks/asset-sync-cmdb"

# ===================================================================
# å›ºä»¶/BIOS ç‰ˆæœ¬ç›‘æ§å‘Šè­¦è§„åˆ™
# ç”¨é€”: ç›‘æ§å›ºä»¶å’Œ BIOS ç‰ˆæœ¬ï¼Œæé†’å‡çº§
# ===================================================================

  - name: hardware-firmware-alerts
    interval: 60s
    rules:

      # å›ºä»¶ç‰ˆæœ¬è¿‡ä½å‘Šè­¦
      - alert: HardwareFirmwareOutdated
        expr: |
          redfish_firmware_version < "2.8.0"
        for: 1m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: firmware
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} å›ºä»¶ç‰ˆæœ¬è¿‡ä½"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **å½“å‰ç‰ˆæœ¬**: {{ $labels.firmware_version }}
            **å»ºè®®ç‰ˆæœ¬**: 2.8.0 æˆ–æ›´é«˜

            **å»ºè®®æ“ä½œ**:
            - æŸ¥çœ‹å‚å•†å‘å¸ƒçš„å›ºä»¶æ›´æ–°
            - åœ¨ç»´æŠ¤çª—å£å‡çº§å›ºä»¶
            - å‡çº§å‰å¤‡ä»½é…ç½®
          runbook_url: "https://your-wiki.com/runbooks/firmware-outdated"

      # BIOS ç‰ˆæœ¬è¿‡ä½å‘Šè­¦
      - alert: HardwareBIOSOutdated
        expr: |
          redfish_bios_version < "2.10.0"
        for: 1m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: bios
        annotations:
          summary: "âš ï¸ æœåŠ¡å™¨ {{ $labels.instance }} BIOS ç‰ˆæœ¬è¿‡ä½"
          description: |
            **æœåŠ¡å™¨**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}
            **å½“å‰ç‰ˆæœ¬**: {{ $labels.bios_version }}
            **å»ºè®®ç‰ˆæœ¬**: 2.10.0 æˆ–æ›´é«˜

            **å»ºè®®æ“ä½œ**:
            - æŸ¥çœ‹å‚å•†å‘å¸ƒçš„ BIOS æ›´æ–°
            - åœ¨ç»´æŠ¤çª—å£å‡çº§ BIOS
            - å‡çº§å‰å¤‡ä»½é…ç½®
          runbook_url: "https://your-wiki.com/runbooks/bios-outdated"

      # å›ºä»¶ç‰ˆæœ¬ä¸ä¸€è‡´å‘Šè­¦ï¼ˆåŒä¸€å‹å·ï¼‰
      - alert: HardwareFirmwareVersionMismatch
        expr: |
          count by (vendor, model) (redfish_firmware_version) 
          > 1
        for: 10m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: firmware
        annotations:
          summary: "âš ï¸ åŒå‹å·æœåŠ¡å™¨ {{ $labels.vendor }} {{ $labels.model }} å›ºä»¶ç‰ˆæœ¬ä¸ä¸€è‡´"
          description: |
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}

            **å»ºè®®æ“ä½œ**:
            - ç»Ÿä¸€å›ºä»¶ç‰ˆæœ¬
            - é¿å…å…¼å®¹æ€§é—®é¢˜
          runbook_url: "https://your-wiki.com/runbooks/firmware-mismatch"

      # BIOS ç‰ˆæœ¬ä¸ä¸€è‡´å‘Šè­¦ï¼ˆåŒä¸€å‹å·ï¼‰
      - alert: HardwareBIOSVersionMismatch
        expr: |
          count by (vendor, model) (redfish_bios_version) 
          > 1
        for: 10m
        labels:
          severity: warning
          priority: P2
          category: hardware
          component: bios
        annotations:
          summary: "âš ï¸ åŒå‹å·æœåŠ¡å™¨ {{ $labels.vendor }} {{ $labels.model }} BIOS ç‰ˆæœ¬ä¸ä¸€è‡´"
          description: |
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}

            **å»ºè®®æ“ä½œ**:
            - ç»Ÿä¸€ BIOS ç‰ˆæœ¬
            - é¿å…å…¼å®¹æ€§é—®é¢˜
          runbook_url: "https://your-wiki.com/runbooks/bios-mismatch"