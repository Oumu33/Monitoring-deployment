groups:
  - name: switch-alerts
    interval: 30s
    rules:
      # äº¤æ¢æœºè®¾å¤‡å®•æœº
      - alert: SwitchDown
        expr: up{job="snmp-exporter"} == 0
        for: 2m
        labels:
          severity: critical
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} æ— æ³•è®¿é—®"
          description: "äº¤æ¢æœº {{ $labels.instance }} å·²ç»æ— æ³•é€šè¿‡ SNMP è®¿é—®è¶…è¿‡ 2 åˆ†é’Ÿ"

      # äº¤æ¢æœº CPU ä½¿ç”¨ç‡è¿‡é«˜
      - alert: SwitchHighCPU
        expr: hrProcessorLoad > 80
        for: 10m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} CPU ä½¿ç”¨ç‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} CPU ä½¿ç”¨ç‡ä¸º {{ $value }}%ï¼ŒæŒç»­ 10 åˆ†é’Ÿ"

      # äº¤æ¢æœº CPU ä½¿ç”¨ç‡ä¸¥é‡è¿‡é«˜
      - alert: SwitchCriticalCPU
        expr: hrProcessorLoad > 95
        for: 5m
        labels:
          severity: critical
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} CPU ä½¿ç”¨ç‡ä¸¥é‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} CPU ä½¿ç”¨ç‡ä¸º {{ $value }}%ï¼Œå·²è¾¾åˆ°ä¸¥é‡çº§åˆ«"

      # äº¤æ¢æœºå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜
      - alert: SwitchHighMemory
        expr: (hrStorageUsed / hrStorageSize) * 100 > 85
        for: 10m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} å†…å­˜ {{ $labels.hrStorageDescr }} ä½¿ç”¨ç‡ä¸º {{ $value | humanize }}%"

      # äº¤æ¢æœºæ¸©åº¦è¿‡é«˜
      - alert: SwitchHighTemperature
        expr: ciscoEnvMonTemperatureStatusValue > 60
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} æ¸©åº¦è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} ä¼ æ„Ÿå™¨ {{ $labels.ciscoEnvMonTemperatureStatusDescr }} æ¸©åº¦ä¸º {{ $value }}Â°C"

      # äº¤æ¢æœºæ¸©åº¦ä¸¥é‡è¿‡é«˜
      - alert: SwitchCriticalTemperature
        expr: ciscoEnvMonTemperatureStatusValue > 70
        for: 2m
        labels:
          severity: critical
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} æ¸©åº¦ä¸¥é‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} ä¼ æ„Ÿå™¨ {{ $labels.ciscoEnvMonTemperatureStatusDescr }} æ¸©åº¦ä¸º {{ $value }}Â°Cï¼Œå¯èƒ½å½±å“è®¾å¤‡ç¨³å®šæ€§"

      # äº¤æ¢æœºé£æ‰‡æ•…éšœ
      - alert: SwitchFanFailure
        expr: ciscoEnvMonFanState != 1
        for: 1m
        labels:
          severity: critical
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} é£æ‰‡æ•…éšœ"
          description: "äº¤æ¢æœº {{ $labels.instance }} é£æ‰‡ {{ $labels.ciscoEnvMonFanStatusDescr }} çŠ¶æ€å¼‚å¸¸ï¼ˆéæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼‰"

      # äº¤æ¢æœºç”µæºæ•…éšœ
      - alert: SwitchPowerSupplyFailure
        expr: ciscoEnvMonSupplyState != 1
        for: 1m
        labels:
          severity: critical
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} ç”µæºæ•…éšœ"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç”µæº {{ $labels.ciscoEnvMonSupplyStatusDescr }} çŠ¶æ€å¼‚å¸¸"

      # äº¤æ¢æœºç«¯å£ä¸‹çº¿ï¼ˆTrunk å£ï¼‰
      - alert: SwitchTrunkPortDown
        expr: ifOperStatus{ifAlias=~".*[Tt]runk.*"} == 2
        for: 3m
        labels:
          severity: critical
          category: network
        annotations:
          summary: "äº¤æ¢æœº Trunk ç«¯å£ {{ $labels.ifDescr }} ä¸‹çº¿"
          description: "äº¤æ¢æœº {{ $labels.instance }} çš„ Trunk ç«¯å£ {{ $labels.ifDescr }} ({{ $labels.ifAlias }}) å·²ä¸‹çº¿"

      # äº¤æ¢æœºç«¯å£ä¸‹çº¿ï¼ˆä¸Šè”å£ï¼‰
      - alert: SwitchUplinkPortDown
        expr: ifOperStatus{ifAlias=~".*[Uu]plink.*"} == 2
        for: 2m
        labels:
          severity: critical
          category: network
        annotations:
          summary: "äº¤æ¢æœºä¸Šè”ç«¯å£ {{ $labels.ifDescr }} ä¸‹çº¿"
          description: "äº¤æ¢æœº {{ $labels.instance }} çš„ä¸Šè”ç«¯å£ {{ $labels.ifDescr }} ({{ $labels.ifAlias }}) å·²ä¸‹çº¿"

      # ç«¯å£é”™è¯¯ç‡è¿‡é«˜ï¼ˆè¾“å…¥é”™è¯¯ï¼‰
      - alert: SwitchPortInputErrors
        expr: rate(ifInErrors[5m]) > 100
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœºç«¯å£ {{ $labels.ifDescr }} è¾“å…¥é”™è¯¯ç‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} æ¯ç§’è¾“å…¥é”™è¯¯åŒ…æ•°ä¸º {{ $value | humanize }}"

      # ç«¯å£é”™è¯¯ç‡è¿‡é«˜ï¼ˆè¾“å‡ºé”™è¯¯ï¼‰
      - alert: SwitchPortOutputErrors
        expr: rate(ifOutErrors[5m]) > 100
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœºç«¯å£ {{ $labels.ifDescr }} è¾“å‡ºé”™è¯¯ç‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} æ¯ç§’è¾“å‡ºé”™è¯¯åŒ…æ•°ä¸º {{ $value | humanize }}"

      # ç«¯å£ä¸¢åŒ…ç‡è¿‡é«˜ï¼ˆè¾“å…¥ä¸¢åŒ…ï¼‰
      - alert: SwitchPortInputDiscards
        expr: rate(ifInDiscards[5m]) > 50
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœºç«¯å£ {{ $labels.ifDescr }} è¾“å…¥ä¸¢åŒ…ç‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} æ¯ç§’è¾“å…¥ä¸¢åŒ…æ•°ä¸º {{ $value | humanize }}"

      # ç«¯å£ä¸¢åŒ…ç‡è¿‡é«˜ï¼ˆè¾“å‡ºä¸¢åŒ…ï¼‰
      - alert: SwitchPortOutputDiscards
        expr: rate(ifOutDiscards[5m]) > 50
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœºç«¯å£ {{ $labels.ifDescr }} è¾“å‡ºä¸¢åŒ…ç‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} æ¯ç§’è¾“å‡ºä¸¢åŒ…æ•°ä¸º {{ $value | humanize }}"

      # ç«¯å£ CRC é”™è¯¯
      - alert: SwitchPortCRCErrors
        expr: rate(dot3StatsFCSErrors[5m]) > 10
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœºç«¯å£ {{ $labels.ifDescr }} CRC é”™è¯¯ç‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} æ¯ç§’ CRC é”™è¯¯æ•°ä¸º {{ $value | humanize }}"

      # ç«¯å£å†²çªæ£€æµ‹ï¼ˆåŠåŒå·¥æ¨¡å¼ä¸‹ï¼‰
      - alert: SwitchPortCollisions
        expr: rate(ifCollisions[5m]) > 10
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœºç«¯å£ {{ $labels.ifDescr }} æ£€æµ‹åˆ°å†²çª"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} æ¯ç§’å†²çªæ¬¡æ•°ä¸º {{ $value | humanize }}ï¼Œå»ºè®®æ£€æŸ¥åŒå·¥æ¨¡å¼é…ç½®"

      # ç«¯å£å¸¦å®½åˆ©ç”¨ç‡è¿‡é«˜ï¼ˆå…¥å‘ï¼‰
      - alert: SwitchPortHighInboundTraffic
        expr: (rate(ifHCInOctets[5m]) * 8 / ifHighSpeed / 1000000) * 100 > 85
        for: 10m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœºç«¯å£ {{ $labels.ifDescr }} å…¥å‘æµé‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} å…¥å‘å¸¦å®½åˆ©ç”¨ç‡ä¸º {{ $value | humanize }}%"

      # ç«¯å£å¸¦å®½åˆ©ç”¨ç‡è¿‡é«˜ï¼ˆå‡ºå‘ï¼‰
      - alert: SwitchPortHighOutboundTraffic
        expr: (rate(ifHCOutOctets[5m]) * 8 / ifHighSpeed / 1000000) * 100 > 85
        for: 10m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœºç«¯å£ {{ $labels.ifDescr }} å‡ºå‘æµé‡è¿‡é«˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} å‡ºå‘å¸¦å®½åˆ©ç”¨ç‡ä¸º {{ $value | humanize }}%"

      # ç«¯å£çŠ¶æ€é¢‘ç¹å˜åŒ–ï¼ˆæŠ–åŠ¨ï¼‰
      - alert: SwitchPortFlapping
        expr: changes(ifOperStatus[10m]) > 5
        for: 1m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœºç«¯å£ {{ $labels.ifDescr }} çŠ¶æ€é¢‘ç¹å˜åŒ–"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} åœ¨è¿‡å» 10 åˆ†é’Ÿå†…çŠ¶æ€å˜åŒ–äº† {{ $value }} æ¬¡ï¼Œå¯èƒ½å­˜åœ¨çº¿è·¯æˆ–è®¾å¤‡é—®é¢˜"

      # STP æ‹“æ‰‘å˜åŒ–è¿‡äºé¢‘ç¹
      - alert: SwitchFrequentSTPChanges
        expr: rate(dot1dStpTopChanges[10m]) > 0.1
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} STP æ‹“æ‰‘å˜åŒ–é¢‘ç¹"
          description: "äº¤æ¢æœº {{ $labels.instance }} STP æ‹“æ‰‘åœ¨è¿‡å» 10 åˆ†é’Ÿå†…å‘ç”Ÿäº†å¤šæ¬¡å˜åŒ–ï¼Œå¯èƒ½å­˜åœ¨ç½‘ç»œç¯è·¯æˆ–é…ç½®é—®é¢˜"

      # äº¤æ¢æœºé…ç½®å˜æ›´
      - alert: SwitchConfigurationChanged
        expr: ccmHistoryRunningLastChanged != ccmHistoryRunningLastSaved
        for: 30m
        labels:
          severity: info
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} é…ç½®å·²å˜æ›´ä½†æœªä¿å­˜"
          description: "äº¤æ¢æœº {{ $labels.instance }} çš„è¿è¡Œé…ç½®å·²å˜æ›´è¶…è¿‡ 30 åˆ†é’Ÿï¼Œä½†å°šæœªä¿å­˜åˆ°å¯åŠ¨é…ç½®"

      # äº¤æ¢æœºç³»ç»Ÿé‡å¯
      - alert: SwitchRebooted
        expr: sysUpTime < 600
        for: 1m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} æœ€è¿‘é‡å¯è¿‡"
          description: "äº¤æ¢æœº {{ $labels.instance }} è¿è¡Œæ—¶é—´å°‘äº 10 åˆ†é’Ÿï¼Œè®¾å¤‡å¯èƒ½åˆšåˆšé‡å¯"

      # MAC åœ°å€è¡¨æ¥è¿‘æ»¡
      - alert: SwitchMACTableNearFull
        expr: (dot1dTpLearnedEntryDiscards / dot1dTpLearnedEntryDiscards) > 0
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœº {{ $labels.instance }} MAC åœ°å€è¡¨æ¥è¿‘æ»¡"
          description: "äº¤æ¢æœº {{ $labels.instance }} MAC åœ°å€è¡¨å®¹é‡ä¸è¶³ï¼Œæ­£åœ¨ä¸¢å¼ƒæ–°çš„ MAC åœ°å€æ¡ç›®"

      # VLAN æ¥å£ä¸‹çº¿
      - alert: SwitchVLANInterfaceDown
        expr: ifOperStatus{ifType="l2vlan"} == 2
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœº VLAN æ¥å£ {{ $labels.ifDescr }} ä¸‹çº¿"
          description: "äº¤æ¢æœº {{ $labels.instance }} çš„ VLAN æ¥å£ {{ $labels.ifDescr }} å·²ä¸‹çº¿"

      # ç«¯å£å®‰å…¨è¿è§„
      - alert: SwitchPortSecurityViolation
        expr: increase(cpsIfPortSecurityViolations[5m]) > 0
        for: 1m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœºç«¯å£ {{ $labels.ifDescr }} æ£€æµ‹åˆ°å®‰å…¨è¿è§„"
          description: "äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} åœ¨è¿‡å» 5 åˆ†é’Ÿå†…æ£€æµ‹åˆ° {{ $value }} æ¬¡ç«¯å£å®‰å…¨è¿è§„"

      # PoE ç«¯å£åŠŸç‡è¿‡è½½
      - alert: SwitchPOEPortOverload
        expr: pethPsePortPower > pethPsePortPowerLimit * 0.95
        for: 5m
        labels:
          severity: warning
          category: network
        annotations:
          summary: "äº¤æ¢æœº PoE ç«¯å£ {{ $labels.pethPsePortIndex }} åŠŸç‡æ¥è¿‘ä¸Šé™"
          description: "äº¤æ¢æœº {{ $labels.instance }} PoE ç«¯å£åŠŸç‡ä¸º {{ $value }}Wï¼Œæ¥è¿‘æˆ–è¶…è¿‡é™åˆ¶"

      # å †å æˆå‘˜ç¦»çº¿ï¼ˆé’ˆå¯¹å †å äº¤æ¢æœºï¼‰
      - alert: SwitchStackMemberDown
        expr: cswSwitchState != 3
        for: 2m
        labels:
          severity: critical
          category: network
        annotations:
          summary: "äº¤æ¢æœºå †å æˆå‘˜ {{ $labels.cswSwitchIndex }} ç¦»çº¿"
          description: "å †å äº¤æ¢æœº {{ $labels.instance }} çš„æˆå‘˜ {{ $labels.cswSwitchIndex }} çŠ¶æ€å¼‚å¸¸"

# ===================================================================
# ç½‘ç»œè®¾å¤‡è”åŠ¨ç›‘æ§å‘Šè­¦è§„åˆ™
# ç”¨é€”: ç½‘ç»œè®¾å¤‡ä¸å…¶ä»–ç³»ç»Ÿæ·±åº¦è”åŠ¨
# ===================================================================

  - name: network-device-linkage-alerts
    interval: 30s
    rules:

      # äº¤æ¢æœºå®•æœº + è‡ªåŠ¨æ—¥å¿—æŸ¥è¯¢
      - alert: SwitchDownWithLogs
        expr: up{job="snmp-exporter"} == 0
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: network
          component: switch
          subcategory: logs
        annotations:
          summary: "ğŸ”´ äº¤æ¢æœº {{ $labels.instance }} å®•æœº"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **å‚å•†**: {{ $labels.vendor }}
            **å‹å·**: {{ $labels.model }}

            **è‡ªåŠ¨æ—¥å¿—æŸ¥è¯¢**:
            ```logql
            {host="{{ $labels.instance }}"} 
            |~ "switch|Switch|down|Down|error|Error" 
            | level =~ "error|warning"
            ```

            **å½±å“èŒƒå›´**:
            - è¿æ¥çš„æœåŠ¡å™¨: {{ $labels.connected_servers }}
            - è¿æ¥çš„äº¤æ¢æœº: {{ $labels.connected_switches }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹ä¸Šè¿°æ—¥å¿—æŸ¥è¯¢ç»“æœ
            2. æŸ¥çœ‹æ‹“æ‰‘å›¾ç¡®è®¤å½±å“èŒƒå›´
            3. è”ç³»ç½‘ç»œå›¢é˜Ÿæ’æŸ¥
          log_query: '{host="{{ $labels.instance }}"} |~ "switch|Switch|down|Down|error|Error" | level =~ "error|warning"'
          grafana_url: "http://localhost:3000/d/logs-explorer?expr={host=%22{{ $labels.instance }}%22}%20%7C~%20%22switch%7CSwitch%7Cdown%7CDown%7Cerror%7CError%22%20%7C%20level%20=~%20%22error%7Cwarning%22"
          runbook_url: "https://your-wiki.com/runbooks/switch-down"

      # äº¤æ¢æœºç«¯å£ä¸‹çº¿ + è‡ªåŠ¨æ’æŸ¥è¿æ¥è®¾å¤‡
      - alert: SwitchPortDownAutoInvestigate
        expr: ifOperStatus == 2
        for: 3m
        labels:
          severity: critical
          priority: P0
          category: network
          component: switch
          subcategory: port
        annotations:
          summary: "ğŸ”´ äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} ä¸‹çº¿"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **ç«¯å£**: {{ $labels.ifDescr }}
            **æè¿°**: {{ $labels.ifAlias }}

            **è¿æ¥è®¾å¤‡**:
            - è®¾å¤‡åç§°: {{ $labels.connected_device }}
            - è®¾å¤‡ç±»å‹: {{ $labels.connected_device_type }}
            - è®¾å¤‡ IP: {{ $labels.connected_device_ip }}

            **è‡ªåŠ¨æ’æŸ¥**:
            - Ping è¿æ¥è®¾å¤‡
            - æ£€æŸ¥è®¾å¤‡çŠ¶æ€
            - æŸ¥çœ‹è®¾å¤‡æ—¥å¿—

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥è¿æ¥è®¾å¤‡çŠ¶æ€
            2. æ£€æŸ¥ç½‘çº¿/å…‰çº¤
            3. æ£€æŸ¥ç«¯å£é…ç½®
          auto_investigate: true
          connected_device: "{{ $labels.connected_device }}"
          connected_device_type: "{{ $labels.connected_device_type }}"
          runbook_url: "https://your-wiki.com/runbooks/switch-port-down"

      # äº¤æ¢æœº CPU è¿‡é«˜ + è‡ªåŠ¨æµé‡åˆ†æ
      - alert: SwitchHighCPUAutoAnalyze
        expr: hrProcessorLoad > 80
        for: 10m
        labels:
          severity: warning
          priority: P1
          category: network
          component: switch
          subcategory: performance
        annotations:
          summary: "âš ï¸ äº¤æ¢æœº {{ $labels.instance }} CPU ä½¿ç”¨ç‡è¿‡é«˜ï¼Œå·²è‡ªåŠ¨åˆ†ææµé‡"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **CPU ä½¿ç”¨ç‡**: {{ $value }}%

            **æµé‡åˆ†æ**:
            - é«˜æµé‡ç«¯å£: {{ $labels.high_traffic_ports }}
            - å¼‚å¸¸æµé‡: {{ $labels.anomalous_traffic }}
            - å¹¿æ’­é£æš´: {{ $labels.broadcast_storm }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹æµé‡åˆ†æç»“æœ
            2. è¯†åˆ«é«˜æµé‡æº
            3. ä¼˜åŒ–æµé‡æˆ–å‡çº§è®¾å¤‡
          auto_analyze: true
          analysis_type: traffic_analysis
          runbook_url: "https://your-wiki.com/runbooks/switch-high-cpu"

      # äº¤æ¢æœºç«¯å£é”™è¯¯ç‡è¿‡é«˜ + è‡ªåŠ¨è¯Šæ–­
      - alert: SwitchPortErrorAutoDiagnose
        expr: |
          (rate(ifInErrors[5m]) + rate(ifOutErrors[5m])) > 100
        for: 5m
        labels:
          severity: warning
          priority: P1
          category: network
          component: switch
          subcategory: port
        annotations:
          summary: "âš ï¸ äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} é”™è¯¯ç‡è¿‡é«˜ï¼Œå·²è‡ªåŠ¨è¯Šæ–­"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **ç«¯å£**: {{ $labels.ifDescr }}
            **é”™è¯¯é€Ÿç‡**: {{ $value }} errors/sec

            **è‡ªåŠ¨è¯Šæ–­**:
            - é”™è¯¯ç±»å‹: {{ $labels.error_type }}
            - å¯èƒ½åŸå› : {{ $labels.possible_cause }}
            - å»ºè®®æ“ä½œ: {{ $labels.recommended_action }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹è¯Šæ–­ç»“æœ
            2. æ£€æŸ¥ç½‘çº¿/å…‰çº¤
            3. æ›´æ¢ç«¯å£æˆ–è®¾å¤‡
          auto_diagnose: true
          error_type: "{{ $labels.error_type }}"
          runbook_url: "https://your-wiki.com/runbooks/switch-port-errors"

      # STP æ‹“æ‰‘å˜åŒ– + è‡ªåŠ¨ç¯è·¯æ£€æµ‹
      - alert: SwitchSTPChangeAutoDetectLoop
        expr: rate(dot1dStpTopChanges[10m]) > 0.1
        for: 5m
        labels:
          severity: warning
          priority: P1
          category: network
          component: switch
          subcategory: stp
        annotations:
          summary: "âš ï¸ äº¤æ¢æœº {{ $labels.instance }} STP æ‹“æ‰‘å˜åŒ–é¢‘ç¹ï¼Œå·²è‡ªåŠ¨æ£€æµ‹ç¯è·¯"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **STP å˜åŒ–é€Ÿç‡**: {{ $value }} changes/min

            **ç¯è·¯æ£€æµ‹**:
            - æ£€æµ‹åˆ°ç¯è·¯: {{ $labels.loop_detected }}
            - ç¯è·¯è·¯å¾„: {{ $labels.loop_path }}
            - å»ºè®®æ“ä½œ: {{ $labels.recommended_action }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹ç¯è·¯æ£€æµ‹ç»“æœ
            2. æ–­å¼€ç¯è·¯ç«¯å£
            3. ä¼˜åŒ–ç½‘ç»œæ‹“æ‰‘
          auto_detect: true
          detection_type: loop_detection
          runbook_url: "https://your-wiki.com/runbooks/switch-stp-loop"

      # äº¤æ¢æœºé…ç½®å˜æ›´ + è‡ªåŠ¨å¤‡ä»½
      - alert: SwitchConfigChangeAutoBackup
        expr: ccmHistoryRunningLastChanged != ccmHistoryRunningLastSaved
        for: 30m
        labels:
          severity: info
          priority: P3
          category: network
          component: switch
          subcategory: config
        annotations:
          summary: "â„¹ï¸ äº¤æ¢æœº {{ $labels.instance }} é…ç½®å·²å˜æ›´ï¼Œå·²è‡ªåŠ¨å¤‡ä»½"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **å˜æ›´æ—¶é—´**: {{ $value }}

            **è‡ªåŠ¨å¤‡ä»½**:
            - å¤‡ä»½ä½ç½®: /backup/switch-configs/
            - å¤‡ä»½æ–‡ä»¶: {{ $labels.backup_file }}
            - å¤‡ä»½æ—¶é—´: {{ $value }}

            **å¤„ç†æ­¥éª¤**:
            1. ç¡®è®¤é…ç½®å˜æ›´
            2. ä¿å­˜é…ç½®åˆ°å¯åŠ¨é…ç½®
            3. éªŒè¯é…ç½®æ­£ç¡®æ€§
          auto_backup: true
          backup_location: "/backup/switch-configs/"
          backup_file: "{{ $labels.backup_file }}"
          runbook_url: "https://your-wiki.com/runbooks/switch-config-backup"

      # äº¤æ¢æœºç«¯å£å®‰å…¨è¿è§„ + è‡ªåŠ¨å°ç¦
      - alert: SwitchPortSecurityViolationAutoBlock
        expr: increase(cpsIfPortSecurityViolations[5m]) > 0
        for: 1m
        labels:
          severity: warning
          priority: P1
          category: network
          component: switch
          subcategory: security
        annotations:
          summary: "âš ï¸ äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} æ£€æµ‹åˆ°å®‰å…¨è¿è§„ï¼Œå·²è‡ªåŠ¨å°ç¦"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **ç«¯å£**: {{ $labels.ifDescr }}
            **è¿è§„æ¬¡æ•°**: {{ $value }}

            **è‡ªåŠ¨å°ç¦**:
            - å°ç¦ MAC: {{ $labels.violating_mac }}
            - å°ç¦æ—¶é•¿: 1 å°æ—¶
            - å°ç¦æ—¶é—´: {{ $value }}

            **å¤„ç†æ­¥éª¤**:
            1. ç¡®è®¤å°ç¦å·²æ‰§è¡Œ
            2. æ£€æŸ¥è¿è§„åŸå› 
            3. è”ç³»å®‰å…¨å›¢é˜Ÿ
          auto_block: true
          block_action: shutdown_port
          violating_mac: "{{ $labels.violating_mac }}"
          runbook_url: "https://your-wiki.com/runbooks/switch-port-security"

      # äº¤æ¢æœºæ¸©åº¦è¿‡é«˜ + è‡ªåŠ¨é™é¢‘
      - alert: SwitchHighTemperatureAutoThrottle
        expr: ciscoEnvMonTemperatureStatusValue > 65
        for: 5m
        labels:
          severity: warning
          priority: P1
          category: network
          component: switch
          subcategory: thermal
        annotations:
          summary: "âš ï¸ äº¤æ¢æœº {{ $labels.instance }} æ¸©åº¦è¿‡é«˜ï¼Œå·²è‡ªåŠ¨é™é¢‘"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **æ¸©åº¦**: {{ $value }}Â°C
            **ä¼ æ„Ÿå™¨**: {{ $labels.ciscoEnvMonTemperatureStatusDescr }}

            **è‡ªåŠ¨é™é¢‘**:
            - é™é¢‘ç­–ç•¥: é™ä½ CPU é¢‘ç‡
            - é™é¢‘å¹…åº¦: 20%
            - é™é¢‘æ—¶é—´: {{ $value }}

            **å¤„ç†æ­¥éª¤**:
            1. æ£€æŸ¥é£æ‰‡çŠ¶æ€
            2. æ£€æŸ¥æœºæˆ¿æ¸©åº¦
            3. è€ƒè™‘å¢åŠ æ•£çƒ­
          auto_throttle: true
          throttle_action: reduce_cpu_frequency
          runbook_url: "https://your-wiki.com/runbooks/switch-high-temperature"

      # äº¤æ¢æœºç«¯å£å¸¦å®½åˆ©ç”¨ç‡è¿‡é«˜ + è‡ªåŠ¨ QoS è°ƒæ•´
      - alert: SwitchPortBandwidthHighAutoQoS
        expr: |
          (rate(ifHCInOctets[5m]) * 8 / ifHighSpeed) > 0.9
        for: 10m
        labels:
          severity: warning
          priority: P2
          category: network
          component: switch
          subcategory: qos
        annotations:
          summary: "âš ï¸ äº¤æ¢æœº {{ $labels.instance }} ç«¯å£ {{ $labels.ifDescr }} å¸¦å®½åˆ©ç”¨ç‡è¿‡é«˜ï¼Œå·²è‡ªåŠ¨è°ƒæ•´ QoS"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **ç«¯å£**: {{ $labels.ifDescr }}
            **å¸¦å®½åˆ©ç”¨ç‡**: {{ $value | humanizePercentage }}

            **è‡ªåŠ¨ QoS è°ƒæ•´**:
            - è°ƒæ•´ç­–ç•¥: ä¼˜å…ˆä¿è¯å…³é”®æµé‡
            - QoS ç­–ç•¥: {{ $labels.qos_policy }}
            - è°ƒæ•´æ—¶é—´: {{ $value }}

            **å¤„ç†æ­¥éª¤**:
            1. æŸ¥çœ‹æµé‡åˆ†æ
            2. ä¼˜åŒ– QoS ç­–ç•¥
            3. è€ƒè™‘æ‰©å®¹å¸¦å®½
          auto_qos: true
          qos_action: prioritize_critical_traffic
          runbook_url: "https://your-wiki.com/runbooks/switch-bandwidth-qos"

      # äº¤æ¢æœºå †å æˆå‘˜ç¦»çº¿ + è‡ªåŠ¨é‡æ–°é€‰ä¸¾
      - alert: SwitchStackMemberDownAutoReelect
        expr: cswSwitchState != 3
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: network
          component: switch
          subcategory: stack
        annotations:
          summary: "ğŸ”´ äº¤æ¢æœºå †å æˆå‘˜ {{ $labels.cswSwitchIndex }} ç¦»çº¿ï¼Œå·²è‡ªåŠ¨é‡æ–°é€‰ä¸¾ä¸»æ§"
          description: |
            **å †å äº¤æ¢æœº**: {{ $labels.instance }}
            **æˆå‘˜**: {{ $labels.cswSwitchIndex }}
            **çŠ¶æ€**: {{ $value }}

            **è‡ªåŠ¨é‡æ–°é€‰ä¸¾**:
            - æ–°ä¸»æ§: {{ $labels.new_master }}
            - é€‰ä¸¾æ—¶é—´: {{ $value }}
            - å½±å“èŒƒå›´: {{ $labels.impact_scope }}

            **å¤„ç†æ­¥éª¤**:
            1. ç¡®è®¤é€‰ä¸¾å®Œæˆ
            2. æ£€æŸ¥ç¦»çº¿æˆå‘˜
            3. ä¿®å¤æˆ–æ›´æ¢æˆå‘˜
          auto_reelect: true
          reelect_action: elect_new_master
          new_master: "{{ $labels.new_master }}"
          runbook_url: "https://your-wiki.com/runbooks/switch-stack-reelect"

      # äº¤æ¢æœº PoE ç«¯å£è¿‡è½½ + è‡ªåŠ¨æ–­ç”µ
      - alert: SwitchPOEOverloadAutoShutdown
        expr: |
          pethPsePortPower > pethPsePortPowerLimit * 0.95
        for: 5m
        labels:
          severity: warning
          priority: P1
          category: network
          component: switch
          subcategory: poe
        annotations:
          summary: "âš ï¸ äº¤æ¢æœº {{ $labels.instance }} PoE ç«¯å£ {{ $labels.pethPsePortIndex }} è¿‡è½½ï¼Œå·²è‡ªåŠ¨æ–­ç”µ"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **ç«¯å£**: {{ $labels.pethPsePortIndex }}
            **å½“å‰åŠŸç‡**: {{ $value }}W
            **åŠŸç‡é™åˆ¶**: {{ $labels.pethPsePortPowerLimit }}W

            **è‡ªåŠ¨æ–­ç”µ**:
            - æ–­ç”µç«¯å£: {{ $labels.pethPsePortIndex }}
            - æ–­ç”µæ—¶é—´: {{ $value }}
            - ä¿æŠ¤æªæ–½: é˜²æ­¢è®¾å¤‡æŸå

            **å¤„ç†æ­¥éª¤**:
            1. ç¡®è®¤æ–­ç”µå·²æ‰§è¡Œ
            2. æ£€æŸ¥è¿æ¥è®¾å¤‡
            3. è€ƒè™‘å‡çº§ PoE ä¾›ç”µ
          auto_shutdown: true
          shutdown_action: disable_poe_port
          runbook_url: "https://your-wiki.com/runbooks/switch-poe-overload"

      # äº¤æ¢æœº BGP ä¼šè¯ä¸­æ–­ + è‡ªåŠ¨é‡è¿
      - alert: SwitchBGPDownAutoReconnect
        expr: bgpPeerState != 6
        for: 2m
        labels:
          severity: critical
          priority: P0
          category: network
          component: switch
          subcategory: bgp
        annotations:
          summary: "ğŸ”´ äº¤æ¢æœº {{ $labels.instance }} BGP ä¼šè¯ {{ $labels.bgpPeerRemoteAddr }} ä¸­æ–­ï¼Œå·²è‡ªåŠ¨é‡è¿"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **BGP å¯¹ç«¯**: {{ $labels.bgpPeerRemoteAddr }}
            **AS å·**: {{ $labels.bgpPeerRemoteAs }}

            **è‡ªåŠ¨é‡è¿**:
            - é‡è¿å°è¯•: {{ $labels.reconnect_attempts }}
            - é‡è¿é—´éš”: 30 ç§’
            - é‡è¿æ—¶é—´: {{ $value }}

            **å¤„ç†æ­¥éª¤**:
            1. ç¡®è®¤é‡è¿çŠ¶æ€
            2. æ£€æŸ¥ BGP é…ç½®
            3. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
          auto_reconnect: true
          reconnect_action: bgp_reconnect
          reconnect_attempts: "{{ $labels.reconnect_attempts }}"
          runbook_url: "https://your-wiki.com/runbooks/switch-bgp-reconnect"

      # äº¤æ¢æœº OSPF é‚»å±…ä¸¢å¤± + è‡ªåŠ¨é‡æ–°è®¡ç®—
      - alert: SwitchOSPFNeighborLostAutoRecalculate
        expr: ospfNeighborState != 8
        for: 2m
        labels:
          severity: warning
          priority: P1
          category: network
          component: switch
          subcategory: ospf
        annotations:
          summary: "âš ï¸ äº¤æ¢æœº {{ $labels.instance }} OSPF é‚»å±… {{ $labels.ospfNeighborIp }} ä¸¢å¤±ï¼Œå·²è‡ªåŠ¨é‡æ–°è®¡ç®—è·¯ç”±"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **OSPF é‚»å±…**: {{ $labels.ospfNeighborIp }}
            **åŒºåŸŸ**: {{ $labels.ospfNeighborArea }}

            **è‡ªåŠ¨é‡æ–°è®¡ç®—**:
            - é‡æ–°è®¡ç®—æ—¶é—´: {{ $value }}
            - æ–°è·¯ç”±æ•°é‡: {{ $labels.new_routes }}
            - å½±å“èŒƒå›´: {{ $labels.impact_scope }}

            **å¤„ç†æ­¥éª¤**:
            1. ç¡®è®¤è·¯ç”±å·²æ›´æ–°
            2. æ£€æŸ¥é‚»å±…çŠ¶æ€
            3. éªŒè¯ç½‘ç»œè¿é€šæ€§
          auto_recalculate: true
          recalculate_action: ospf_recalculate
          new_routes: "{{ $labels.new_routes }}"
          runbook_url: "https://your-wiki.com/runbooks/switch-ospf-recalculate"

      # äº¤æ¢æœº ARP è¡¨å¼‚å¸¸ + è‡ªåŠ¨æ¸…ç†
      - alert: SwitchARPTableAnomalyAutoClean
        expr: |
          count(ipNetToMediaPhysAddress) by (instance) > 10000
        for: 10m
        labels:
          severity: warning
          priority: P2
          category: network
          component: switch
          subcategory: arp
        annotations:
          summary: "âš ï¸ äº¤æ¢æœº {{ $labels.instance }} ARP è¡¨å¼‚å¸¸ï¼Œå·²è‡ªåŠ¨æ¸…ç†"
          description: |
            **äº¤æ¢æœº**: {{ $labels.instance }}
            **ARP æ¡ç›®æ•°**: {{ $value }}

            **è‡ªåŠ¨æ¸…ç†**:
            - æ¸…ç†ç­–ç•¥: æ¸…ç†è¿‡æœŸæ¡ç›®
            - æ¸…ç†æ•°é‡: {{ $labels.cleaned_entries }}
            - æ¸…ç†æ—¶é—´: {{ $value }}

            **å¤„ç†æ­¥éª¤**:
            1. ç¡®è®¤æ¸…ç†å®Œæˆ
            2. æ£€æŸ¥ç½‘ç»œé…ç½®
            3. è€ƒè™‘å¢åŠ  ARP è¡¨å®¹é‡
          auto_clean: true
          clean_action: clear_expired_arp_entries
          cleaned_entries: "{{ $labels.cleaned_entries }}"
          runbook_url: "https://your-wiki.com/runbooks/switch-arp-clean"
