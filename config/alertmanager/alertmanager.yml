# ===================================================================
# Alertmanager é…ç½®æ–‡ä»¶
# ç”¨é€”: å‘Šè­¦è·¯ç”±ã€åˆ†ç»„ã€æŠ‘åˆ¶å’Œé€šçŸ¥ç®¡ç†
# æ–‡æ¡£: https://prometheus.io/docs/alerting/latest/configuration/
# ===================================================================

# ===== å…¨å±€é…ç½® =====
global:
  # å‘Šè­¦æ¢å¤è¶…æ—¶æ—¶é—´
  resolve_timeout: 5m

  # SMTP é‚®ä»¶é…ç½®ï¼ˆéœ€è¦æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰
  smtp_smarthost: 'smtp.example.com:587'
  smtp_from: 'alertmanager@example.com'
  smtp_auth_username: 'alertmanager@example.com'
  smtp_auth_password: 'your-password'
  smtp_require_tls: true

  # é‚®ä»¶é€šçŸ¥æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰
  # smtp_hello: 'alertmanager.example.com'

# ===== å‘Šè­¦è·¯ç”±é…ç½® =====
route:
  # å‘Šè­¦åˆ†ç»„ç­–ç•¥ï¼ˆå¯è§‚æµ‹æ€§ä¼˜åŒ–ç‰ˆï¼‰
  # æŒ‰ç…§æ‹“æ‰‘ç»“æ„åˆ†ç»„ï¼Œè‡ªåŠ¨å…³è”ç›¸å…³å‘Šè­¦
  group_by: ['datacenter', 'network_segment', 'rack', 'alertname', 'priority']

  # åˆ†ç»„ç­‰å¾…æ—¶é—´: æ”¶åˆ°ç¬¬ä¸€ä¸ªå‘Šè­¦åï¼Œç­‰å¾… 30 ç§’çœ‹æ˜¯å¦æœ‰å…¶ä»–åŒç»„å‘Šè­¦
  # ç›®çš„: æ”¶é›†åŒä¸€æ—¶é—´æ®µçš„å…³è”å‘Šè­¦ï¼Œä¾¿äºæ ¹å› åˆ†æ
  group_wait: 30s

  # åˆ†ç»„é—´éš”: åŒä¸€ç»„å‘Šè­¦å‘é€åï¼Œè‡³å°‘ç­‰å¾… 5 åˆ†é’Ÿæ‰èƒ½å†æ¬¡å‘é€
  # ç›®çš„: é¿å…æŒç»­çš„å‘Šè­¦è½°ç‚¸
  group_interval: 5m

  # é‡å¤é—´éš”: åŒä¸€å‘Šè­¦å¦‚æœä¸€ç›´æœªæ¢å¤ï¼Œæ¯ 12 å°æ—¶é‡å¤å‘é€ä¸€æ¬¡
  # ç›®çš„: æé†’è¿ç»´äººå‘˜å‘Šè­¦å°šæœªè§£å†³
  repeat_interval: 12h

  # é»˜è®¤æ¥æ”¶å™¨
  receiver: 'default'

  # ===== å­è·¯ç”±ï¼ˆæŒ‰ä¼˜å…ˆçº§å’Œç±»å‹åˆ†å‘å‘Šè­¦ï¼‰=====
  routes:
    # ===== P0 æœ€é«˜ä¼˜å…ˆçº§å‘Šè­¦ï¼ˆç«‹å³é€šçŸ¥ï¼‰=====
    - match:
        priority: P0
      receiver: 'p0-alerts'
      group_wait: 10s          # ä»…ç­‰å¾… 10 ç§’
      repeat_interval: 5m      # æ¯ 5 åˆ†é’Ÿé‡å¤å‘é€
      continue: false          # ä¸ç»§ç»­åŒ¹é…å…¶ä»–è·¯ç”±

    # ===== P1 ç´§æ€¥å‘Šè­¦ =====
    - match:
        priority: P1
      receiver: 'p1-alerts'
      group_wait: 30s
      repeat_interval: 15m
      continue: false

    # ===== P2 è­¦å‘Šå‘Šè­¦ =====
    - match:
        priority: P2
      receiver: 'p2-alerts'
      group_wait: 1m
      repeat_interval: 1h
      continue: false

    # ===== P3 ä¿¡æ¯å‘Šè­¦ï¼ˆä½ä¼˜å…ˆçº§ï¼‰=====
    - match:
        priority: P3
      receiver: 'p3-alerts'
      group_wait: 5m
      repeat_interval: 24h
      continue: false

    # ===== ç›‘æ§ç³»ç»Ÿè‡ªèº«å‘Šè­¦ï¼ˆç‰¹æ®Šå¤„ç†ï¼‰=====
    - match:
        category: monitoring
      receiver: 'monitoring-system-alerts'
      group_by: ['alertname']  # æŒ‰å‘Šè­¦åç§°åˆ†ç»„
      group_wait: 10s
      repeat_interval: 10m
      continue: false

    # ===== VMware è™šæ‹ŸåŒ–å‘Šè­¦ =====
    - match:
        category: vmware
      receiver: 'vmware-alerts'
      group_by: ['alertname', 'clustername']  # æŒ‰é›†ç¾¤åˆ†ç»„
      group_wait: 30s
      repeat_interval: 30m

    # ===== ç½‘ç»œè®¾å¤‡å‘Šè­¦ =====
    - match:
        category: network
      receiver: 'network-alerts'
      group_by: ['alertname', 'device_type']
      group_wait: 1m
      repeat_interval: 30m

    # ===== å®‰å…¨å‘Šè­¦ï¼ˆSSL è¯ä¹¦ç­‰ï¼‰=====
    - match:
        category: security
      receiver: 'security-alerts'
      group_wait: 5m
      repeat_interval: 6h

# ===== å‘Šè­¦æ¥æ”¶å™¨é…ç½® =====
receivers:
  # é»˜è®¤æ¥æ”¶å™¨ï¼ˆå…œåº•ï¼‰
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:5001/webhook'
        send_resolved: true

  # ===== P0 æœ€é«˜ä¼˜å…ˆçº§å‘Šè­¦æ¥æ”¶å™¨ =====
  # å‘é€: é‚®ä»¶ + çŸ­ä¿¡ + ç”µè¯ + Webhook
  - name: 'p0-alerts'
    email_configs:
      - to: 'oncall@example.com,admin@example.com'
        headers:
          Subject: 'ğŸš¨ğŸ”´ã€P0 ç´§æ€¥å‘Šè­¦ã€‘{{ .GroupLabels.alertname }}'
        html: |
          <h2 style="color: red;">ğŸš¨ P0 ç´§æ€¥å‘Šè­¦</h2>
          <p><strong>å½±å“ç­‰çº§</strong>: æœ€é«˜ï¼ˆä¸šåŠ¡ä¸­æ–­ï¼‰</p>
          <p><strong>å¤„ç†è¦æ±‚</strong>: ç«‹å³å“åº”ï¼Œ15 åˆ†é’Ÿå†…å¼€å§‹å¤„ç†</p>

          {{ range .Alerts }}
          <hr>
          <h3>{{ .Labels.alertname }}</h3>
          <table border="1" cellpadding="5">
            <tr><td><strong>å‘Šè­¦çº§åˆ«</strong></td><td>{{ .Labels.priority }}</td></tr>
            <tr><td><strong>å®ä¾‹</strong></td><td>{{ .Labels.instance }}</td></tr>
            <tr><td><strong>åˆ†ç±»</strong></td><td>{{ .Labels.category }}</td></tr>
            <tr><td><strong>ç»„ä»¶</strong></td><td>{{ .Labels.component }}</td></tr>
            <tr><td><strong>æ‘˜è¦</strong></td><td>{{ .Annotations.summary }}</td></tr>
            <tr><td><strong>è¯¦æƒ…</strong></td><td><pre>{{ .Annotations.description }}</pre></td></tr>
            <tr><td><strong>å¤„ç†æ‰‹å†Œ</strong></td><td><a href="{{ .Annotations.runbook_url }}">æŸ¥çœ‹ Runbook</a></td></tr>
            <tr><td><strong>å¼€å§‹æ—¶é—´</strong></td><td>{{ .StartsAt.Format "2006-01-02 15:04:05" }}</td></tr>
          </table>
          {{ end }}
        send_resolved: true

    # Webhook ç¤ºä¾‹ï¼ˆå¯å¯¹æ¥ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ã€Slackç­‰ï¼‰
    webhook_configs:
      - url: 'http://localhost:5001/webhook/p0'
        send_resolved: true

  # ===== P1 ç´§æ€¥å‘Šè­¦æ¥æ”¶å™¨ =====
  - name: 'p1-alerts'
    email_configs:
      - to: 'oncall@example.com'
        headers:
          Subject: 'ğŸ”´ã€P1 ç´§æ€¥ã€‘{{ .GroupLabels.alertname }}'
        html: |
          <h2 style="color: orange;">ğŸ”´ P1 ç´§æ€¥å‘Šè­¦</h2>
          <p><strong>å½±å“ç­‰çº§</strong>: é«˜ï¼ˆæœåŠ¡é™çº§ï¼‰</p>
          <p><strong>å¤„ç†è¦æ±‚</strong>: 30 åˆ†é’Ÿå†…å“åº”</p>

          {{ range .Alerts }}
          <hr>
          <h3>{{ .Labels.alertname }}</h3>
          <p><strong>å®ä¾‹</strong>: {{ .Labels.instance }}</p>
          <p><strong>æ‘˜è¦</strong>: {{ .Annotations.summary }}</p>
          <p><strong>è¯¦æƒ…</strong>: <pre>{{ .Annotations.description }}</pre></p>
          <p><strong>å¤„ç†æ‰‹å†Œ</strong>: <a href="{{ .Annotations.runbook_url }}">æŸ¥çœ‹ Runbook</a></p>
          {{ end }}
        send_resolved: true

  # ===== P2 è­¦å‘Šå‘Šè­¦æ¥æ”¶å™¨ =====
  - name: 'p2-alerts'
    email_configs:
      - to: 'ops@example.com'
        headers:
          Subject: 'âš ï¸ã€P2 è­¦å‘Šã€‘{{ .GroupLabels.alertname }}'
        html: |
          <h2>âš ï¸ P2 è­¦å‘Šå‘Šè­¦</h2>
          <p><strong>å½±å“ç­‰çº§</strong>: ä¸­ï¼ˆæ½œåœ¨é£é™©ï¼‰</p>
          <p><strong>å¤„ç†è¦æ±‚</strong>: 2 å°æ—¶å†…å¤„ç†</p>

          {{ range .Alerts }}
          <p><strong>{{ .Labels.alertname }}</strong>: {{ .Annotations.summary }}</p>
          {{ end }}
        send_resolved: true

  # ===== P3 ä¿¡æ¯å‘Šè­¦æ¥æ”¶å™¨ =====
  - name: 'p3-alerts'
    email_configs:
      - to: 'ops@example.com'
        headers:
          Subject: 'â„¹ï¸ã€P3 ä¿¡æ¯ã€‘{{ .GroupLabels.alertname }}'
        send_resolved: true

  # ===== ç›‘æ§ç³»ç»Ÿå‘Šè­¦æ¥æ”¶å™¨ =====
  - name: 'monitoring-system-alerts'
    email_configs:
      - to: 'monitoring-admin@example.com'
        headers:
          Subject: 'ğŸ”§ã€ç›‘æ§ç³»ç»Ÿã€‘{{ .GroupLabels.alertname }}'
        html: |
          <h2>ç›‘æ§ç³»ç»Ÿå‘Šè­¦</h2>
          {{ range .Alerts }}
          <p><strong>æœåŠ¡</strong>: {{ .Labels.job }}</p>
          <p><strong>æ‘˜è¦</strong>: {{ .Annotations.summary }}</p>
          <p><strong>è¯¦æƒ…</strong>: <pre>{{ .Annotations.description }}</pre></p>
          {{ end }}
        send_resolved: true

  # ===== VMware è™šæ‹ŸåŒ–å‘Šè­¦æ¥æ”¶å™¨ =====
  - name: 'vmware-alerts'
    email_configs:
      - to: 'vmware-team@example.com'
        headers:
          Subject: 'â˜ï¸ã€VMwareã€‘{{ .GroupLabels.alertname }}'
        send_resolved: true

  # ===== ç½‘ç»œè®¾å¤‡å‘Šè­¦æ¥æ”¶å™¨ =====
  - name: 'network-alerts'
    email_configs:
      - to: 'network-team@example.com'
        headers:
          Subject: 'ğŸŒã€ç½‘ç»œã€‘{{ .GroupLabels.alertname }}'
        send_resolved: true

  # ===== å®‰å…¨å‘Šè­¦æ¥æ”¶å™¨ =====
  - name: 'security-alerts'
    email_configs:
      - to: 'security-team@example.com'
        headers:
          Subject: 'ğŸ”’ã€å®‰å…¨ã€‘{{ .GroupLabels.alertname }}'
        send_resolved: true

# ===== å‘Šè­¦æŠ‘åˆ¶è§„åˆ™ï¼ˆé˜²æ­¢å‘Šè­¦é£æš´ï¼‰=====
inhibit_rules:
  # ===== ä¸»æœºçº§åˆ«æŠ‘åˆ¶ =====

  # è§„åˆ™ 1: ä¸»æœºå®•æœºæ—¶ï¼ŒæŠ‘åˆ¶è¯¥ä¸»æœºçš„æ‰€æœ‰å…¶ä»–å‘Šè­¦
  # åŸå› : ä¸»æœºéƒ½å®•æœºäº†ï¼Œå…¶ä»– CPUã€å†…å­˜ã€ç£ç›˜å‘Šè­¦æ²¡æœ‰æ„ä¹‰
  - source_match:
      alertname: 'HostDown'
    target_match_re:
      alertname: '(HighCPU.*|HighMemory.*|HighDisk.*|HighSystemLoad.*|NetworkInterfaceDown)'
    equal: ['instance']

  # ===== ESXi ä¸»æœºçº§åˆ«æŠ‘åˆ¶ =====

  # è§„åˆ™ 2: ESXi ä¸»æœºå®•æœºæ—¶ï¼ŒæŠ‘åˆ¶è¯¥ä¸»æœºä¸Šæ‰€æœ‰ VM çš„å‘Šè­¦
  # åŸå› : ESXi å®•æœºä¼šå¯¼è‡´æ‰€æœ‰ VM å®•æœºï¼Œé¿å…å‘Šè­¦è½°ç‚¸
  - source_match_re:
      alertname: 'ESXiHigh.*Critical|HostDown'
      device_type: 'esxi'
    target_match:
      alertname: 'VMDown'
    equal: ['esxhostname']

  # è§„åˆ™ 3: ESXi ä¸»æœºå®•æœºæ—¶ï¼ŒæŠ‘åˆ¶è¯¥ä¸»æœºçš„å…¶ä»–æ€§èƒ½å‘Šè­¦
  - source_match:
      alertname: 'HostDown'
      device_type: 'esxi'
    target_match_re:
      alertname: '(ESXiHigh.*|DatastoreLowSpace.*)'
    equal: ['instance']

  # ===== æ•°æ®å­˜å‚¨çº§åˆ«æŠ‘åˆ¶ =====

  # è§„åˆ™ 4: æ•°æ®å­˜å‚¨ç©ºé—´ä¸¥é‡ä¸è¶³æ—¶ï¼ŒæŠ‘åˆ¶è¯¥å­˜å‚¨ä¸Š VM çš„ç£ç›˜å‘Šè­¦
  - source_match:
      alertname: 'DatastoreLowSpaceCritical'
    target_match_re:
      alertname: '(VMHighMemory.*|VMHighCPU.*)'
    equal: ['dsname']

  # ===== ç½‘ç»œè®¾å¤‡çº§åˆ«æŠ‘åˆ¶ =====

  # è§„åˆ™ 5: ç½‘ç»œè®¾å¤‡ Ping ä¸é€šæ—¶ï¼ŒæŠ‘åˆ¶è¯¥è®¾å¤‡çš„æ¥å£å‘Šè­¦
  - source_match:
      alertname: 'HostDown'
      category: 'network'
    target_match_re:
      alertname: '(InterfaceDown|HighInterfaceErrors|HighInterfaceTraffic)'
    equal: ['instance']

  # è§„åˆ™ 6: SNMP è®¾å¤‡ä¸å¯è¾¾æ—¶ï¼ŒæŠ‘åˆ¶è¯¥è®¾å¤‡çš„æ‰€æœ‰ SNMP å‘Šè­¦
  - source_match:
      alertname: 'SNMPDeviceDown'
    target_match_re:
      alertname: '(InterfaceDown|HighInterfaceErrors|HighInterfaceTraffic)'
    equal: ['instance']

  # ===== ç½‘ç«™/æœåŠ¡çº§åˆ«æŠ‘åˆ¶ =====

  # è§„åˆ™ 7: ç½‘ç«™å®•æœºæ—¶ï¼ŒæŠ‘åˆ¶è¯¥ç½‘ç«™çš„æ…¢å“åº”å‘Šè­¦
  - source_match:
      alertname: 'WebsiteDown'
    target_match_re:
      alertname: '(WebsiteSlow.*|WebsiteHTTPStatusCode)'
    equal: ['instance']

  # ===== ç›‘æ§ç³»ç»Ÿçº§åˆ«æŠ‘åˆ¶ =====

  # è§„åˆ™ 8: VictoriaMetrics å®•æœºæ—¶ï¼ŒæŠ‘åˆ¶æ‰€æœ‰å…¶ä»–ç›‘æ§å‘Šè­¦
  # åŸå› : æ²¡æœ‰æ•°æ®åº“ï¼Œæ‰€æœ‰ç›‘æ§éƒ½ä¼šå¤±æ•ˆ
  - source_match:
      alertname: 'VictoriaMetricsDown'
    target_match_re:
      alertname: '.*'
    equal: []  # æŠ‘åˆ¶æ‰€æœ‰å‘Šè­¦

  # è§„åˆ™ 9: vmagent å®•æœºæ—¶ï¼ŒæŠ‘åˆ¶é‡‡é›†ç›®æ ‡å®•æœºå‘Šè­¦
  # åŸå› : vmagent å®•æœºä¼šå¯¼è‡´æ‰€æœ‰é‡‡é›†ç›®æ ‡æ˜¾ç¤ºä¸ºå®•æœº
  - source_match:
      alertname: 'VMAgentDown'
    target_match:
      alertname: 'TargetDown'
    equal: []

  # ===== ä¼˜å…ˆçº§çº§åˆ«æŠ‘åˆ¶ =====

  # è§„åˆ™ 10: Critical å‘Šè­¦æŠ‘åˆ¶åŒä¸€å‘Šè­¦çš„ Warning çº§åˆ«
  # åŸå› : CPU 95% Critical å·²ç»è§¦å‘ï¼Œä¸éœ€è¦å†å‘é€ CPU 85% Warning
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']

  # è§„åˆ™ 11: P0 æŠ‘åˆ¶åŒä¸€å‘Šè­¦çš„ P1/P2
  - source_match:
      priority: 'P0'
    target_match_re:
      priority: '(P1|P2|P3)'
    equal: ['alertname', 'instance']

  # ===== æ ¹å› åˆ†ææŠ‘åˆ¶è§„åˆ™ï¼ˆå¯è§‚æµ‹æ€§å¢å¼ºï¼‰=====

  # è§„åˆ™ 12: æ ¸å¿ƒäº¤æ¢æœºæ•…éšœæŠ‘åˆ¶æ¥å…¥äº¤æ¢æœºå‘Šè­¦
  # åŸå› : æ ¸å¿ƒäº¤æ¢æœºæ•…éšœä¼šå¯¼è‡´ä¸‹æ¸¸äº¤æ¢æœºä¸å¯è¾¾
  - source_match:
      alertname: 'SwitchDown'
      device_tier: 'core'
    target_match:
      alertname: 'SwitchDown'
      device_tier: 'access'
    equal: ['network_segment']

  # è§„åˆ™ 13: äº¤æ¢æœº CPU é«˜æŠ‘åˆ¶ç½‘ç»œå»¶è¿Ÿå‘Šè­¦
  # åŸå› : äº¤æ¢æœº CPU é«˜æ˜¯æ ¹å› ï¼Œç½‘ç»œå»¶è¿Ÿæ˜¯ç»“æœ
  - source_match:
      alertname: 'SwitchCPUHigh'
      severity: 'critical'
    target_match_re:
      alertname: '(NetworkLatency|HighPing|PacketLoss)'
    equal: ['network_segment']

  # è§„åˆ™ 14: äº¤æ¢æœºæµé‡é£æš´æŠ‘åˆ¶å…¶ä»–ç½‘ç»œå‘Šè­¦
  # åŸå› : æµé‡é£æš´æ˜¯æ ¹å› ï¼Œå…¶ä»–ç½‘ç»œé—®é¢˜æ˜¯è¿é”ååº”
  - source_match_re:
      alertname: '(TrafficStorm|BroadcastStorm)'
    target_match_re:
      alertname: '(SwitchCPUHigh|NetworkLatency|InterfaceDown)'
    equal: ['instance']

  # è§„åˆ™ 15: äº¤æ¢æœºæ¥å£ Down æŠ‘åˆ¶è¿æ¥åˆ°è¯¥æ¥å£çš„æœåŠ¡å™¨å‘Šè­¦
  # åŸå› : æ¥å£ Down ä¼šå¯¼è‡´æœåŠ¡å™¨ç½‘ç»œä¸å¯è¾¾
  - source_match:
      alertname: 'InterfaceDown'
      device_type: 'switch'
    target_match_re:
      alertname: '(HostDown|NetworkUnreachable)'
    equal: ['connected_switch_port']  # éœ€è¦åœ¨æ ‡ç­¾ä¸­æ ‡è®°è¿æ¥å…³ç³»

  # è§„åˆ™ 16: ESXi å­˜å‚¨è·¯å¾„æ•…éšœæŠ‘åˆ¶ VM ç£ç›˜ IO å‘Šè­¦
  # åŸå› : å­˜å‚¨è·¯å¾„æ•…éšœä¼šå¯¼è‡´æ‰€æœ‰ VM ç£ç›˜ IO æ…¢
  - source_match:
      alertname: 'ESXiStoragePathDown'
    target_match_re:
      alertname: '(VMHighDiskIO|VMDiskLatency)'
    equal: ['esxi_host']

  # è§„åˆ™ 17: æ•°æ®ä¸­å¿ƒçº§åˆ«æ•…éšœæŠ‘åˆ¶æœºæˆ¿å†…æ‰€æœ‰å‘Šè­¦
  # åŸå› : æ•´ä¸ªæ•°æ®ä¸­å¿ƒæ•…éšœï¼ˆå¦‚åœç”µï¼‰ï¼ŒæŠ‘åˆ¶æ‰€æœ‰è®¾å¤‡å‘Šè­¦
  - source_match:
      alertname: 'DatacenterPowerLoss'
    target_match_re:
      alertname: '.*'
    equal: ['datacenter']

  # è§„åˆ™ 18: ä¸Šæ¸¸æœåŠ¡æ•…éšœæŠ‘åˆ¶ä¸‹æ¸¸æœåŠ¡å‘Šè­¦
  # åŸå› : æ•°æ®åº“æ•…éšœä¼šå¯¼è‡´åº”ç”¨æœåŠ¡ä¸å¯ç”¨
  - source_match:
      alertname: 'ServiceDown'
      service_tier: 'backend'
    target_match:
      alertname: 'ServiceDown'
      service_tier: 'frontend'
    equal: ['depends_on']  # éœ€è¦åœ¨æ ‡ç­¾ä¸­æ ‡è®°ä¾èµ–å…³ç³»

  # è§„åˆ™ 19: ç¡¬ä»¶æ•…éšœæŠ‘åˆ¶æ€§èƒ½å‘Šè­¦
  # åŸå› : ç¡¬ä»¶ï¼ˆé£æ‰‡ã€ç”µæºï¼‰æ•…éšœä¼šå¯¼è‡´ CPU æ¸©åº¦é«˜ç­‰æ€§èƒ½é—®é¢˜
  - source_match_re:
      alertname: '(FanFailure|PowerSupplyFailure)'
      severity: 'critical'
    target_match_re:
      alertname: '(HighCPUTemperature|HighSystemTemperature)'
    equal: ['instance']

  # è§„åˆ™ 20: ç½‘ç»œè®¾å¤‡ç¡¬ä»¶æ•…éšœæŠ‘åˆ¶ç½‘ç»œæ€§èƒ½å‘Šè­¦
  - source_match_re:
      alertname: '(HighCPUTemperature|FanFailure|PowerSupplyFailure)'
      device_type: 'switch'
    target_match_re:
      alertname: '(SwitchCPUHigh|HighMemory|InterfaceErrors)'
    equal: ['instance']

# ===================================================================
# é…ç½®è¯´æ˜:
#
# 1. å‘Šè­¦è·¯ç”±ç­–ç•¥:
#    - æŒ‰ä¼˜å…ˆçº§è·¯ç”±ï¼ˆP0/P1/P2/P3ï¼‰
#    - æŒ‰ç±»åˆ«è·¯ç”±ï¼ˆVMwareã€Networkã€Securityï¼‰
#    - æŒ‰å›¢é˜Ÿè·¯ç”±ï¼ˆä¸åŒå›¢é˜Ÿæ¥æ”¶ä¸åŒå‘Šè­¦ï¼‰
#
# 2. å‘Šè­¦åˆ†ç»„ç­–ç•¥:
#    - ç›¸åŒ alertname + instance + priority åˆå¹¶ä¸ºä¸€æ¡é€šçŸ¥
#    - ç›®çš„: é¿å…çŸ­æ—¶é—´å†…æ”¶åˆ°å¤§é‡ç›¸åŒå‘Šè­¦
#
# 3. å‘Šè­¦æŠ‘åˆ¶ç­–ç•¥:
#    - ä¸»æœºå®•æœº â†’ æŠ‘åˆ¶è¯¥ä¸»æœºæ‰€æœ‰å…¶ä»–å‘Šè­¦
#    - ESXi å®•æœº â†’ æŠ‘åˆ¶æ‰€æœ‰ VM å‘Šè­¦
#    - è®¾å¤‡ä¸å¯è¾¾ â†’ æŠ‘åˆ¶è®¾å¤‡æ¥å£å‘Šè­¦
#    - Critical â†’ æŠ‘åˆ¶ Warning
#
# 4. é€šçŸ¥ç­–ç•¥:
#    - P0: 10 ç§’ç­‰å¾…ï¼Œ5 åˆ†é’Ÿé‡å¤ï¼ˆç´§æ€¥ï¼‰
#    - P1: 30 ç§’ç­‰å¾…ï¼Œ15 åˆ†é’Ÿé‡å¤
#    - P2: 1 åˆ†é’Ÿç­‰å¾…ï¼Œ1 å°æ—¶é‡å¤
#    - P3: 5 åˆ†é’Ÿç­‰å¾…ï¼Œ24 å°æ—¶é‡å¤
#
# 5. å‘Šè­¦æ¢å¤:
#    - æ‰€æœ‰æ¥æ”¶å™¨éƒ½é…ç½® send_resolved: true
#    - å‘Šè­¦æ¢å¤åä¼šå‘é€æ¢å¤é€šçŸ¥
#
# 6. é›†æˆç¬¬ä¸‰æ–¹é€šçŸ¥:
#    - ä¼ä¸šå¾®ä¿¡: https://work.weixin.qq.com/api/doc/90000/90136/91770
#    - é’‰é’‰: https://open.dingtalk.com/document/robots/custom-robot-access
#    - Slack: https://api.slack.com/messaging/webhooks
#
# æ›´å¤šæ–‡æ¡£: docs/ALERTMANAGER-GUIDE.md
# ===================================================================
