{{ define "feishu.card.title" }}
{{ if eq .Status "firing" }}ğŸ”¥ å‘Šè­¦è§¦å‘{{ else }}âœ… å‘Šè­¦æ¢å¤{{ end }}
{{ end }}

{{ define "feishu.card.content" }}
{
  "msg_type": "interactive",
  "card": {
    "header": {
      "template": "{{ if eq .Status \"firing\" }}red{{ else if eq .Labels.severity \"warning\" }}orange{{ else if eq .Labels.severity \"critical\" }}red{{ else }}green{{ end }}",
      "title": {
        "content": "{{ if eq .Status \"firing\" }}ğŸ”¥ å‘Šè­¦è§¦å‘{{ else }}âœ… å‘Šè­¦æ¢å¤{{ end }}",
        "tag": "plain_text"
      }
    },
    "elements": [
      {
        "tag": "div",
        "text": {
          "content": "**å‘Šè­¦çº§åˆ«:** {{ .Labels.severity }}\n**å‘Šè­¦æ•°é‡:** {{ len .Alerts }}\n**è§¦å‘æ—¶é—´:** {{ (index .Alerts 0).StartsAt.Format \"2006-01-02 15:04:05\" }}",
          "tag": "lark_md"
        }
      },
      {
        "tag": "hr"
      },
      {{ range $i, $alert := .Alerts }}
      {
        "tag": "div",
        "text": {
          "content": "### ğŸ“Œ {{ $alert.Labels.alertname }}\n\n**å®ä¾‹:** {{ $alert.Labels.instance }}\n**æ‘˜è¦:** {{ $alert.Annotations.summary }}\n\n**æè¿°:**\n{{ $alert.Annotations.description }}\n\n{{ if $alert.Annotations.prediction_value }}**é¢„æµ‹ä¿¡æ¯:**\n- é¢„æµ‹å€¼: {{ $alert.Annotations.prediction_value }}\n- å½“å‰å€¼: {{ $alert.Annotations.current_value }}\n- é¢„æµ‹è´¨é‡: {{ $alert.Annotations.prediction_quality }}\n- é¢„æµ‹ç½®ä¿¡åº¦: {{ $alert.Annotations.prediction_confidence }}\n- é¢„æµ‹æ–¹æ³•: {{ $alert.Annotations.prediction_method }}\n\n{{ end }}**æ ‡ç­¾:**\n{{ range $key, $value := $alert.Labels }}- {{ $key }}: {{ $value }}\n{{ end }}",
          "tag": "lark_md"
        }
      },
      {{ if lt $i (sub (len $.Alerts) 1) }}{
        "tag": "hr"
      },{{ end }}
      {{ end }}
      {
        "tag": "hr"
      },
      {
        "tag": "action",
        "actions": [
          {
            "tag": "button",
            "text": {
              "content": "ğŸ” æŸ¥çœ‹è¯¦æƒ…",
              "tag": "plain_text"
            },
            "type": "primary",
            "url": "http://localhost:3000/d/alerts"
          },
          {
            "tag": "button",
            "text": {
              "content": "ğŸ“Š Grafana",
              "tag": "plain_text"
            },
            "type": "default",
            "url": "http://localhost:3000"
          }
        ]
      }
    ]
  }
}
{{ end }}

{{ define "feishu.text.content" }}
{{ if eq .Status "firing" }}ğŸ”¥ å‘Šè­¦è§¦å‘{{ else }}âœ… å‘Šè­¦æ¢å¤{{ end }}

**å‘Šè­¦çº§åˆ«:** {{ .Labels.severity }}
**å‘Šè­¦æ•°é‡:** {{ len .Alerts }}
**è§¦å‘æ—¶é—´:** {{ (index .Alerts 0).StartsAt.Format "2006-01-02 15:04:05" }}

{{ range .Alerts }}
---
### ğŸ“Œ {{ .Labels.alertname }}

**å®ä¾‹:** {{ .Labels.instance }}
**æ‘˜è¦:** {{ .Annotations.summary }}

**æè¿°:**
{{ .Annotations.description }}

{{ if .Annotations.prediction_value }}
**é¢„æµ‹ä¿¡æ¯:**
- é¢„æµ‹å€¼: {{ .Annotations.prediction_value }}
- å½“å‰å€¼: {{ .Annotations.current_value }}
- é¢„æµ‹è´¨é‡: {{ .Annotations.prediction_quality }}
- é¢„æµ‹ç½®ä¿¡åº¦: {{ .Annotations.prediction_confidence }}
- é¢„æµ‹æ–¹æ³•: {{ .Annotations.prediction_method }}

{{ end }}**æ ‡ç­¾:**
{{ range $key, $value := .Labels }}- {{ $key }}: {{ $value }}
{{ end }}

{{ end }}

---
ğŸ”— [æŸ¥çœ‹è¯¦æƒ…](http://localhost:3000/d/alerts) | ğŸ“Š [Grafana](http://localhost:3000)
{{ end }}

{{ define "feishu.predictive.alert" }}
{
  "msg_type": "interactive",
  "card": {
    "header": {
      "template": "{{ if eq .Labels.severity \"critical\" }}red{{ else if eq .Labels.severity \"warning\" }}orange{{ else }}green{{ end }}",
      "title": {
        "content": "ğŸ”® é¢„æµ‹æ€§å‘Šè­¦ - {{ .Labels.alertname }}",
        "tag": "plain_text"
      }
    },
    "elements": [
      {
        "tag": "div",
        "text": {
          "content": "**å®ä¾‹:** {{ .Labels.instance }}\n**å‘Šè­¦çº§åˆ«:** {{ .Labels.severity }}\n**é¢„æµ‹æ—¶é—´çª—å£:** {{ .Annotations.prediction_horizon }}",
          "tag": "lark_md"
        }
      },
      {
        "tag": "hr"
      },
      {
        "tag": "div",
        "text": {
          "content": "### ğŸ“Š é¢„æµ‹è¯¦æƒ…\n\n**å½“å‰å€¼:** {{ .Annotations.current_value }}\n**é¢„æµ‹å€¼:** {{ .Annotations.prediction_value }}\n**é¢„æµ‹è´¨é‡:** {{ .Annotations.prediction_quality }}\n**é¢„æµ‹ç¨³å®šæ€§:** {{ .Annotations.prediction_stability }}\n**é¢„æµ‹ç½®ä¿¡åº¦:** {{ .Annotations.prediction_confidence }}\n**é¢„æµ‹æ–¹æ³•:** {{ .Annotations.prediction_method }}\n\n### ğŸ“ˆ å¤šæ¨¡å‹å¯¹æ¯”\n\n| æ¨¡å‹ | é¢„æµ‹å€¼ | å‡†ç¡®åº¦ |\n|------|--------|--------|\n| çº¿æ€§å›å½’ | {{ .Annotations.linear_prediction }} | {{ .Annotations.linear_accuracy }} |\n| å­£èŠ‚æ€§ | {{ .Annotations.seasonal_prediction }} | {{ .Annotations.seasonal_accuracy }} |\n| å¤šæŒ‡æ ‡ | {{ .Annotations.multivariate_prediction }} | {{ .Annotations.multivariate_accuracy }} |\n| èåˆé¢„æµ‹ | {{ .Annotations.ensemble_prediction }} | {{ .Annotations.ensemble_accuracy }} |\n| **è‡ªé€‚åº”** | **{{ .Annotations.prediction_value }}** | **{{ .Annotations.adaptive_accuracy }}** |\n\n### ğŸ“… å†å²å¯¹æ¯”\n\n- æ˜¨å¤©åŒæœŸ: {{ .Annotations.history_yesterday }}\n- ä¸Šå‘¨åŒæœŸ: {{ .Annotations.history_last_week }}\n- 7 å¤©åŸºçº¿: {{ .Annotations.history_baseline_7d }}\n- å†å²åå·®: {{ .Annotations.deviation_from_history }}\n\n### ğŸ”„ å­£èŠ‚æ€§åˆ†æ\n\n- è¶‹åŠ¿åˆ†é‡: {{ .Annotations.seasonal_trend }}\n- å­£èŠ‚æ€§åˆ†é‡: {{ .Annotations.seasonal_seasonal }}\n- æ®‹å·®åˆ†é‡: {{ .Annotations.seasonal_residual }}\n- æ¯æ—¥åŸºçº¿: {{ .Annotations.seasonal_daily_baseline }}\n\n### ğŸ¯ å»ºè®®æ“ä½œ\n\n{{ .Annotations.auto_mitigation_suggestions }}\n\n### ğŸ›¡ï¸ é¢„é˜²æªæ–½\n\n{{ .Annotations.preventive_measures }}",
          "tag": "lark_md"
        }
      },
      {
        "tag": "hr"
      },
      {
        "tag": "action",
        "actions": [
          {
            "tag": "button",
            "text": {
              "content": "ğŸ” æŸ¥çœ‹è¯¦æƒ…",
              "tag": "plain_text"
            },
            "type": "primary",
            "url": "http://localhost:3000/d/alerts"
          },
          {
            "tag": "button",
            "text": {
              "content": "ğŸ“Š Grafana",
              "tag": "plain_text"
            },
            "type": "default",
            "url": "http://localhost:3000"
          },
          {
            "tag": "button",
            "text": {
              "content": "ğŸ“– è¿ç»´æ‰‹å†Œ",
              "tag": "plain_text"
            },
            "type": "default",
            "url": "{{ .Annotations.runbook_url }}"
          }
        ]
      }
    ]
  }
}
{{ end }}